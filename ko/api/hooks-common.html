
<!DOCTYPE HTML>
<html lang="ko" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Common Hooks · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-feathers-versions/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="client.html" />
    
    
    <link rel="prev" href="hooks.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="검색어 입력" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../guides/readme.html">
            
                <a href="../guides/readme.html">
            
                    
                    Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../guides/about/readme.html">
            
                <a href="../guides/about/readme.html">
            
                    
                    About Feathers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../guides/about/features.html">
            
                <a href="../guides/about/features.html">
            
                    
                    Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../guides/about/philosophy.html">
            
                <a href="../guides/about/philosophy.html">
            
                    
                    Philosophy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../guides/about/vs.html">
            
                <a href="../guides/about/vs.html">
            
                    
                    Feathers vs. X
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../guides/step-by-step/readme.html">
            
                <a href="../guides/step-by-step/readme.html">
            
                    
                    The Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../guides/step-by-step/intro/readme.html">
            
                <a href="../guides/step-by-step/intro/readme.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../guides/step-by-step/intro/not-worry.html">
            
                <a href="../guides/step-by-step/intro/not-worry.html">
            
                    
                    What not to worry about
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../guides/step-by-step/preliminaries.html">
            
                <a href="../guides/step-by-step/preliminaries.html">
            
                    
                    Installing the Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../guides/step-by-step/basic-feathers/readme.html">
            
                <a href="../guides/step-by-step/basic-feathers/readme.html">
            
                    
                    Basic Feathers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../guides/step-by-step/basic-feathers/database-connector.html">
            
                <a href="../guides/step-by-step/basic-feathers/database-connector.html">
            
                    
                    A database connector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.6" data-path="../guides/step-by-step/basic-feathers/rest-api-server.html">
            
                <a href="../guides/step-by-step/basic-feathers/rest-api-server.html">
            
                    
                    A REST API server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.7" data-path="../guides/step-by-step/basic-feathers/rest-client.html">
            
                <a href="../guides/step-by-step/basic-feathers/rest-client.html">
            
                    
                    A Feathers REST client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.8" data-path="../guides/step-by-step/basic-feathers/socket-client.html">
            
                <a href="../guides/step-by-step/basic-feathers/socket-client.html">
            
                    
                    A Feathers WebSocket client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.9" data-path="../guides/step-by-step/basic-feathers/a-ha.html">
            
                <a href="../guides/step-by-step/basic-feathers/a-ha.html">
            
                    
                    The "a-ha!" moment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.10" data-path="../guides/step-by-step/basic-feathers/hooks-middleware.html">
            
                <a href="../guides/step-by-step/basic-feathers/hooks-middleware.html">
            
                    
                    Hooks middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.11" data-path="../guides/step-by-step/basic-feathers/all-about-hooks.html">
            
                <a href="../guides/step-by-step/basic-feathers/all-about-hooks.html">
            
                    
                    All about hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.12" data-path="../guides/step-by-step/basic-feathers/hooks-1.html">
            
                <a href="../guides/step-by-step/basic-feathers/hooks-1.html">
            
                    
                    Hooks, part 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.13" data-path="../guides/step-by-step/basic-feathers/hooks-2.html">
            
                <a href="../guides/step-by-step/basic-feathers/hooks-2.html">
            
                    
                    Hooks, part 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.14" data-path="../guides/step-by-step/basic-feathers/writing-hooks.html">
            
                <a href="../guides/step-by-step/basic-feathers/writing-hooks.html">
            
                    
                    Writing your own hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.15" data-path="../guides/step-by-step/basic-feathers/testing-hooks.html">
            
                <a href="../guides/step-by-step/basic-feathers/testing-hooks.html">
            
                    
                    Testing hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.16" data-path="../guides/step-by-step/basic-feathers/real-time.html">
            
                <a href="../guides/step-by-step/basic-feathers/real-time.html">
            
                    
                    Real-time
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../guides/step-by-step/generators/readme.html">
            
                <a href="../guides/step-by-step/generators/readme.html">
            
                    
                    The Generator (CLI)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../guides/step-by-step/generators/gen-app.html">
            
                <a href="../guides/step-by-step/generators/gen-app.html">
            
                    
                    Generate the application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../guides/step-by-step/generators/gen-authentication.html">
            
                <a href="../guides/step-by-step/generators/gen-authentication.html">
            
                    
                    Add authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../guides/step-by-step/generators/gen-service.html">
            
                <a href="../guides/step-by-step/generators/gen-service.html">
            
                    
                    Add the teams service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../guides/step-by-step/generators/gen-hook.html">
            
                <a href="../guides/step-by-step/generators/gen-hook.html">
            
                    
                    Add the populate hook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../guides/step-by-step/generators/gen-run.html">
            
                <a href="../guides/step-by-step/generators/gen-run.html">
            
                    
                    Run the application
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../guides/chat/readme.html">
            
                <a href="../guides/chat/readme.html">
            
                    
                    A Chat Application
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../guides/chat/creating.html">
            
                <a href="../guides/chat/creating.html">
            
                    
                    Creating the application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../guides/chat/service.html">
            
                <a href="../guides/chat/service.html">
            
                    
                    Generating a service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.3" data-path="../guides/chat/frontend.html">
            
                <a href="../guides/chat/frontend.html">
            
                    
                    Building a frontend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.4" data-path="../guides/chat/authentication.html">
            
                <a href="../guides/chat/authentication.html">
            
                    
                    Adding authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.5" data-path="../guides/chat/processing.html">
            
                <a href="../guides/chat/processing.html">
            
                    
                    Processing data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../guides/frameworks/readme.html">
            
                <a href="../guides/frameworks/readme.html">
            
                    
                    Frameworks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.5.1" >
            
                <span>
            
                    
                    React and React Native
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.2" >
            
                <span>
            
                    
                    VueJS
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.3" >
            
                <span>
            
                    
                    Angular
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5.4" >
            
                <span>
            
                    
                    Others
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../guides/auth/readme.html">
            
                <a href="../guides/auth/readme.html">
            
                    
                    Authentication
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.6.1" data-path="../guides/auth/how-jwt-works.html">
            
                <a href="../guides/auth/how-jwt-works.html">
            
                    
                    How JWT works
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.2" >
            
                <a target="_blank" href="https://github.com/feathersjs/feathers-authentication/blob/master/docs/new-1.0-features.md">
            
                    
                    What's New (external link)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.3" >
            
                <a target="_blank" href="https://github.com/feathersjs/feathers-authentication/blob/master/docs/migrating.md">
            
                    
                    Migration Guide (external link)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.4" data-path="../guides/auth/recipe.customize-response.html">
            
                <a href="../guides/auth/recipe.customize-response.html">
            
                    
                    Recipe: Custom Login Response
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.5" data-path="../guides/auth/recipe.customize-jwt-payload.html">
            
                <a href="../guides/auth/recipe.customize-jwt-payload.html">
            
                    
                    Recipe: Custom JWT Payload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.6" data-path="../guides/auth/recipe.mixed-auth.html">
            
                <a href="../guides/auth/recipe.mixed-auth.html">
            
                    
                    Recipe: Mixed Auth Endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6.7" data-path="../guides/auth/recipe.oauth-basic.html">
            
                <a href="../guides/auth/recipe.oauth-basic.html">
            
                    
                    Recipe: Basic OAuth
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../guides/offline-first/readme.html">
            
                <a href="../guides/offline-first/readme.html">
            
                    
                    Offline first
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.7.1" data-path="../guides/offline-first/strategies.html">
            
                <a href="../guides/offline-first/strategies.html">
            
                    
                    Strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.2" data-path="../guides/offline-first/snapshot.html">
            
                <a href="../guides/offline-first/snapshot.html">
            
                    
                    Snapshot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.3" data-path="../guides/offline-first/realtime.html">
            
                <a href="../guides/offline-first/realtime.html">
            
                    
                    Realtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.4" data-path="../guides/offline-first/optimistic-mutation.html">
            
                <a href="../guides/offline-first/optimistic-mutation.html">
            
                    
                    Optimistic mutation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.5" data-path="../guides/offline-first/owndata-ownnet.html">
            
                <a href="../guides/offline-first/owndata-ownnet.html">
            
                    
                    Own-data, own-net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.6" data-path="../guides/offline-first/syncdata-syncnet.html">
            
                <a href="../guides/offline-first/syncdata-syncnet.html">
            
                    
                    Sync-data, sync-net
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.7" data-path="../guides/offline-first/configure-snapshot.html">
            
                <a href="../guides/offline-first/configure-snapshot.html">
            
                    
                    Configure snapshot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.8" data-path="../guides/offline-first/configure-realtime.html">
            
                <a href="../guides/offline-first/configure-realtime.html">
            
                    
                    Configure realtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.9" data-path="../guides/offline-first/configure-publication.html">
            
                <a href="../guides/offline-first/configure-publication.html">
            
                    
                    Configure publication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.10" data-path="../guides/offline-first/example-snapshot.html">
            
                <a href="../guides/offline-first/example-snapshot.html">
            
                    
                    Example snapshot
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.11" data-path="../guides/offline-first/example-realtime.html">
            
                <a href="../guides/offline-first/example-realtime.html">
            
                    
                    Example realtime & publication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.12" data-path="../guides/offline-first/example-optimistic.html">
            
                <a href="../guides/offline-first/example-optimistic.html">
            
                    
                    Example optimistic mutation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.13" data-path="../guides/offline-first/example-tests.html">
            
                <a href="../guides/offline-first/example-tests.html">
            
                    
                    Tests as examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7.14" data-path="../guides/offline-first/example-more.html">
            
                <a href="../guides/offline-first/example-more.html">
            
                    
                    More examples
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../guides/advanced/readme.html">
            
                <a href="../guides/advanced/readme.html">
            
                    
                    Advanced topics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.8.1" data-path="../guides/advanced/debugging.html">
            
                <a href="../guides/advanced/debugging.html">
            
                    
                    Debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.2" data-path="../guides/advanced/configuration.html">
            
                <a href="../guides/advanced/configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.3" data-path="../guides/advanced/file-uploading.html">
            
                <a href="../guides/advanced/file-uploading.html">
            
                    
                    File uploads
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.4" data-path="../guides/advanced/creating-a-plugin.html">
            
                <a href="../guides/advanced/creating-a-plugin.html">
            
                    
                    Creating a Feathers plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.5" data-path="../guides/advanced/seeding-services.html">
            
                <a href="../guides/advanced/seeding-services.html">
            
                    
                    Seeding services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.6" data-path="../guides/advanced/using-a-view-engine.html">
            
                <a href="../guides/advanced/using-a-view-engine.html">
            
                    
                    Using a view engine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8.7" data-path="../guides/advanced/scaling.html">
            
                <a href="../guides/advanced/scaling.html">
            
                    
                    Scaling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="readme.html">
            
                <a href="readme.html">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Core
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="application.html">
            
                <a href="application.html">
            
                    
                    Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="services.html">
            
                <a href="services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="hooks.html">
            
                <a href="hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.1.4" data-path="hooks-common.html">
            
                <a href="hooks-common.html">
            
                    
                    Common Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="client.html">
            
                <a href="client.html">
            
                    
                    Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.7" data-path="errors.html">
            
                <a href="errors.html">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" >
            
                <span>
            
                    
                    Transports
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="rest.html">
            
                <a href="rest.html">
            
                    
                    REST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="express.html">
            
                <a href="express.html">
            
                    
                    Express
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="socketio.html">
            
                <a href="socketio.html">
            
                    
                    Socket.io
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.4" data-path="primus.html">
            
                <a href="primus.html">
            
                    
                    Primus
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    Authentication
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="authentication/server.html">
            
                <a href="authentication/server.html">
            
                    
                    Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="authentication/client.html">
            
                <a href="authentication/client.html">
            
                    
                    Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.3" data-path="authentication/local.html">
            
                <a href="authentication/local.html">
            
                    
                    Local
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.4" data-path="authentication/local-management.html">
            
                <a href="authentication/local-management.html">
            
                    
                    Local management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.5" data-path="authentication/jwt.html">
            
                <a href="authentication/jwt.html">
            
                    
                    JWT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.6" data-path="authentication/oauth1.html">
            
                <a href="authentication/oauth1.html">
            
                    
                    OAuth1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.7" data-path="authentication/oauth2.html">
            
                <a href="authentication/oauth2.html">
            
                    
                    OAuth2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.8" data-path="authentication/hooks.html">
            
                <a href="authentication/hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" >
            
                <span>
            
                    
                    Databases
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="databases/common.html">
            
                <a href="databases/common.html">
            
                    
                    Common API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="databases/querying.html">
            
                <a href="databases/querying.html">
            
                    
                    Querying
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="databases/memory.html">
            
                <a href="databases/memory.html">
            
                    
                    Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.4" data-path="databases/nedb.html">
            
                <a href="databases/nedb.html">
            
                    
                    NeDb
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.5" data-path="databases/localstorage.html">
            
                <a href="databases/localstorage.html">
            
                    
                    LocalStorage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.6" data-path="databases/mongodb.html">
            
                <a href="databases/mongodb.html">
            
                    
                    MongoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.7" data-path="databases/mongoose.html">
            
                <a href="databases/mongoose.html">
            
                    
                    Mongoose
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.8" data-path="databases/sequelize.html">
            
                <a href="databases/sequelize.html">
            
                    
                    Sequelize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.9" data-path="databases/knexjs.html">
            
                <a href="databases/knexjs.html">
            
                    
                    Knex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.10" data-path="databases/rethinkdb.html">
            
                <a href="databases/rethinkdb.html">
            
                    
                    RethinkDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.11" data-path="databases/elasticsearch.html">
            
                <a href="databases/elasticsearch.html">
            
                    
                    Elasticsearch
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../SECURITY.html">
            
                <a href="../SECURITY.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../ecosystem/readme.html">
            
                <a href="../ecosystem/readme.html">
            
                    
                    Ecosystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../help/readme.html">
            
                <a href="../help/readme.html">
            
                    
                    Help
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../faq/readme.html">
            
                <a href="../faq/readme.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../contributing/readme.html">
            
                <a href="../contributing/readme.html">
            
                    
                    Contributing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../license.md">
            
                <span>
            
                    
                    License
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            GitBook에 게시
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Common Hooks</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="common-hooks">Common Hooks</h1>
<p><a href="https://github.com/feathersjs/feathers-hooks-common/" target="_blank"><img src="https://img.shields.io/github/stars/feathersjs/feathers-hooks-common.png?style=social&amp;label=Star" alt="GitHub stars"></a>
<a href="https://www.npmjs.com/package/feathers-hooks-common" target="_blank"><img src="https://img.shields.io/npm/v/feathers-hooks-common.png?style=flat-square" alt="npm version"></a>
<a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/CHANGELOG.md" target="_blank"><img src="https://img.shields.io/badge/changelog-.md-blue.png?style=flat-square" alt="Changelog"></a></p>
<pre><code>$ npm install feathers-hooks-common --save
</code></pre><p><code>feathers-hooks-common</code> is a collection of common <a href="hooks.html">hooks</a> and utilities.</p>
<p><a href="authentication/hooks.html">Authentication hooks</a> are documented separately.</p>
<blockquote>
<p><strong>Note:</strong> Many hooks are just a few lines of code to implement from scratch. If you can&apos;t find a hook here but are unsure how to implement it or have an idea for a generally useful hook create a new issue <a href="https://github.com/feathersjs/feathers-hooks-common/issues/new" target="_blank">here</a>.</p>
</blockquote>
<h2 id="client">client</h2>
<h3 id="client-whitelist-source"><code>client(... whitelist)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/client.js" target="_blank">source</a></h3>
<p>A hook for passing params from the client to the server.</p>
<ul>
<li>Used as a <code>before</code> hook.</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> Use the <code>paramsFromClient</code> hook instead.
It does exactly the same thing as <code>client</code> but is less likely to be deprecated.</p>
</blockquote>
<p>Only the <code>hook.params.query</code> object is transferred to the server from a Feathers client,
for security among other reasons.
However if you can include a <code>hook.params.query.$client</code> object, e.g.</p>
<pre><code class="lang-js">service.find({
  query: {
    dept: <span class="hljs-string">&apos;a&apos;</span>,
    $client: {
      populate: <span class="hljs-string">&apos;po-1&apos;</span>,
      serialize: <span class="hljs-string">&apos;po-mgr&apos;</span>
    }
  }
});
</code></pre>
<p>the <code>client</code> hook will move that data to <code>hook.params</code> on the server.</p>
<pre><code class="lang-js">service.before({ all: [ client(<span class="hljs-string">&apos;populate&apos;</span>, <span class="hljs-string">&apos;serialize&apos;</span>, <span class="hljs-string">&apos;otherProp&apos;</span>), myHook ]});
<span class="hljs-comment">// myHook&apos;s hook.params will be</span>
<span class="hljs-comment">// { query: { dept: &apos;a&apos; }, populate: &apos;po-1&apos;, serialize: &apos;po-mgr&apos; } }</span>
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>whitelist</code> (<em>optional</em>) Names of the potential props to transfer from <code>query.client</code>.
Other props are ignored. This is a security feature.</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> You can use the same technique for service calls made on the server.</p>
</blockquote>
<p>See <code>Util: paramsForServer</code> and <code>paramsFromClient</code>.</p>
<h2 id="combine">combine</h2>
<h3 id="combine-hookfuncs-source"><code>combine(... hookFuncs)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/combine.js" target="_blank">source</a></h3>
<p>Sequentially execute multiple hooks within a custom hook function.</p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">hook</span>) </span>{ <span class="hljs-comment">// an arrow func cannot be used because we need &apos;this&apos;</span>
  <span class="hljs-comment">// ...</span>
  hooks.combine(hook1, hook2, hook3).call(<span class="hljs-keyword">this</span>, hook)
    .then(hook =&gt; {});
}
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>hooks</code> (<em>optional</em>) - The hooks to run.</li>
</ul>
<blockquote>
<p><strong>ProTip:</strong> <code>combine</code> is primarily intended to be used within your custom hooks,
not when <a href="hooks.html#registering-hooks">registering hooks.</a>.
Its more convenient to use the following when registering hooks:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> workflow = [hook1(), hook2(), ...];
app.service(...).hooks({
  before: {
    update: [...workflow],
    patch: [...workflow],
  },
});
</code></pre>
</blockquote>
<h2 id="debug">debug</h2>
<h3 id="debuglabel-source"><code>debug(label)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/debug.js" target="_blank">source</a></h3>
<p>Display current info about the hook to console.</p>
<ul>
<li>Used as a <code>before</code> or <code>after</code> hook.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { debug } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

debug(<span class="hljs-string">&apos;step 1&apos;</span>)
<span class="hljs-comment">// * step 1</span>
<span class="hljs-comment">// type: before, method: create</span>
<span class="hljs-comment">// data: { name: &apos;Joe Doe&apos; }</span>
<span class="hljs-comment">// query: { sex: &apos;m&apos; }</span>
<span class="hljs-comment">// result: { assigned: true }</span>
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>label</code> (<em>optional</em>) - Label to identify the debug listing.</li>
</ul>
<h2 id="depopulate">dePopulate</h2>
<h3 id="depopulate-source"><code>dePopulate()</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/de-populate.js" target="_blank">source</a></h3>
<p>Removes joined and <a href="#added-properties">computed</a> properties, as well any profile information.
Populated and serialized items may, after dePopulate, be used in <code>service.patch(id, items)</code> calls.</p>
<ul>
<li>Used as a <strong>before</strong> or <strong>after</strong> hook on any service method.</li>
<li>Supports multiple result items, including paginated <code>find</code>.</li>
<li>Supports an array of keys in <code>field</code>.</li>
</ul>
<p>See also populate, serialize.</p>
<h2 id="disallow">disallow</h2>
<h3 id="disallowproviders-source"><code>disallow(...providers)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/disallow.js" target="_blank">source</a></h3>
<p>Disallows access to a service method completely or for specific providers. All providers
(REST, Socket.io and Primus) set the hook.params.provider property, and disallow checks this.</p>
<ul>
<li>Used as a <code>before</code> hook.</li>
</ul>
<pre><code class="lang-js">app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  <span class="hljs-comment">// Users can not be created by external access</span>
  create: hooks.disallow(<span class="hljs-string">&apos;external&apos;</span>),
  <span class="hljs-comment">// A user can not be deleted through the REST provider</span>
  remove: hooks.disallow(<span class="hljs-string">&apos;rest&apos;</span>),
  <span class="hljs-comment">// disallow calling `update` completely (e.g. to allow only `patch`)</span>
  update: hooks.disallow(),
  <span class="hljs-comment">// disallow the remove hook if the user is not an admin</span>
  remove: hooks.when(hook =&gt; !hook.params.user.isAdmin, hooks.disallow())
});
</code></pre>
<blockquote>
<p><strong>ProTip</strong> Service methods that are not implemented do not need to be disallowed.</p>
</blockquote>
<p><strong>Options:</strong></p>
<ul>
<li><code>providers</code> (<em>optional</em>, default: disallows everything) - The transports that you want to disallow this service method for. Options are:<ul>
<li><code>socketio</code> - will disallow the method for the Socket.IO provider</li>
<li><code>primus</code> - will disallow the method for the Primus provider</li>
<li><code>rest</code> - will disallow the method for the REST provider</li>
<li><code>external</code> - will disallow access from all providers other than the server.</li>
<li><code>server</code> - will disallow access for the server</li>
</ul>
</li>
</ul>
<h2 id="disablemultiitemchange">disableMultiItemChange</h2>
<h3 id="disablemultiitemchange-source"><code>disableMultiItemChange()</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/disable-multi-item-change.js" target="_blank">source</a></h3>
<p>Disables update, patch and remove methods from using null as an id, e.g. remove(null).
A null id affects all the items in the DB, so accidentally using it may have undesirable results.</p>
<ul>
<li>Used as a <code>before</code> hook.</li>
</ul>
<pre><code class="lang-js">app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  update: hooks.disableMultiItemChange(),
});
</code></pre>
<h2 id="discard">discard</h2>
<h3 id="discard-fieldnames-source"><code>discard(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/discard.js" target="_blank">source</a></h3>
<p>Delete the given fields either from the data submitted or from the result. If the data is an array or a paginated <code>find</code> result the hook will Delete the field(s) for every item.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
<li>Used as an <code>after</code> hook.</li>
<li>Field names support dot notation e.g. <code>name.address.city</code>.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { discard } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// Delete the hashed `password` and `salt` field after all method calls</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).after(discard(<span class="hljs-string">&apos;password&apos;</span>, <span class="hljs-string">&apos;salt&apos;</span>));

<span class="hljs-comment">// Delete _id for `create`, `update` and `patch`</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  create: discard(<span class="hljs-string">&apos;_id&apos;</span>, <span class="hljs-string">&apos;password&apos;</span>),
  update: discard(<span class="hljs-string">&apos;_id&apos;</span>),
  patch: discard(<span class="hljs-string">&apos;_id&apos;</span>)
})
</code></pre>
<blockquote>
<p><strong>ProTip:</strong> This hook will always delete the fields,
unlike the <code>remove</code> hook which only deletes the fields if the service call was made by a client.</p>
</blockquote>
<hr>
<blockquote>
<p><strong>ProTip:</strong> You can replace <code>remove(&apos;name&apos;)</code> with <code>iff(isProvider(&apos;external&apos;), discard(&apos;name))</code>.
The latter does not contains any hidden &quot;magic&quot;.</p>
</blockquote>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>required</em>) - One or more fields you want to remove from the object(s).</li>
</ul>
<p>See also remove.</p>
<h2 id="else">else</h2>
<h3 id="iffelsehookfuncs-source"><code>iff(...).else(...hookFuncs)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/iff.js#L10" target="_blank">source</a></h3>
<p><code>iff().else()</code> is similar to <code>iff</code> and <code>iffElse</code>.
Its syntax is more suitable for writing nested conditional hooks.
If the predicate in the <code>iff()</code> is falsey, run the hooks in <code>else()</code> sequentially.</p>
<ul>
<li>Used as a <code>before</code> or <code>after</code> hook.</li>
<li>Hooks to run may be sync, Promises or callbacks.</li>
<li><code>feathers-hooks</code> catches any errors thrown in the predicate or hook.</li>
</ul>
<pre><code class="lang-javascript">service.before({
  create:
    hooks.iff(isProvider(<span class="hljs-string">&apos;server&apos;</span>),
      hookA,
      hooks.iff(isProvider(<span class="hljs-string">&apos;rest&apos;</span>), hook1, hook2, hook3)
        .else(hook4, hook5),
      hookB
    )
      .else(
        hooks.iff(hook =&gt; hook.path === <span class="hljs-string">&apos;users&apos;</span>, hook6, hook7)
      )
});
</code></pre>
<p>or: </p>
<pre><code class="lang-javascript">service.before({
  create:
    hooks.iff(isServer, [
      hookA,
      hooks.iff(isProvider(<span class="hljs-string">&apos;rest&apos;</span>), [hook1, hook2, hook3])
        .else([hook4, hook5]),
      hookB
    ])
      .else([
        hooks.iff(hook =&gt; hook.path === <span class="hljs-string">&apos;users&apos;</span>, [hook6, hook7])
      ])
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>hookFuncs</code> (<em>optional</em>) - Zero or more hook functions.
They may include other conditional hooks.
Or you can use an array of hook functions as the second parameter.</li>
</ul>
<p>See also iff, iffElse, when, unless, isNot, isProvider.</p>
<blockquote>
<p><strong>This</strong> The predicate and hook functions in the if, else and iffElse hooks
will not be called with <code>this</code> set to the service.
Use <code>hook.service</code> instead.</p>
</blockquote>
<h2 id="every">every</h2>
<h3 id="every-hookfuncs-source"><code>every(... hookFuncs)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/every.js" target="_blank">source</a></h3>
<p>Run hook functions in parallel.
Return <code>true</code> if every hook function returned a truthy value.</p>
<ul>
<li>Used as a predicate function with conditional hooks.</li>
<li>The current <code>hook</code> is passed to all the hook functions, and they are run in parallel.</li>
<li>Hooks to run may be sync or Promises only.</li>
<li><code>feathers-hooks</code> catches any errors thrown in the predicate.</li>
</ul>
<pre><code class="lang-javascript">service.before({
  create: hooks.iff(hooks.every(hook1, hook2, ...), hookA, hookB, ...)
});
</code></pre>
<pre><code class="lang-javascript">hooks.every(hook1, hook2, ...).call(<span class="hljs-keyword">this</span>, currentHook)
  .then(bool =&gt; { ... });
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>hookFuncs</code> (<em>required</em>) Functions which take the current hook as a param and return a boolean result.</li>
</ul>
<p>See also some.</p>
<h2 id="iff">iff</h2>
<h3 id="iffpredicate-booleanpromisefunction-hookfuncs-hookfunc-hookfunc-source"><code>iff(predicate: boolean|Promise|function, ...hookFuncs: HookFunc[]): HookFunc</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/iff.js" target="_blank">source</a></h3>
<p>Resolve the predicate to a boolean.
Run the hooks sequentially if the result is truthy.</p>
<ul>
<li>Used as a <code>before</code> or <code>after</code> hook.</li>
<li>Predicate may be a sync or async function.</li>
<li>Hooks to run may be sync, Promises or callbacks.</li>
<li><code>feathers-hooks</code> catches any errors thrown in the predicate or hook.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { iff, populate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
<span class="hljs-keyword">const</span> isNotAdmin = adminRole =&gt; hook =&gt; hook.params.user.roles.indexOf(adminRole || <span class="hljs-string">&apos;admin&apos;</span>) === <span class="hljs-number">-1</span>;

app.service(<span class="hljs-string">&apos;workOrders&apos;</span>).after({
  <span class="hljs-comment">// async predicate and hook</span>
  create: iff(
    () =&gt; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; { ... }),
    populate(<span class="hljs-string">&apos;user&apos;</span>, { field: <span class="hljs-string">&apos;authorisedByUserId&apos;</span>, service: <span class="hljs-string">&apos;users&apos;</span> })
  )
});

app.service(<span class="hljs-string">&apos;workOrders&apos;</span>).after({
  <span class="hljs-comment">// sync predicate and hook</span>
  find: [ iff(isNotAdmin(), hooks.remove(<span class="hljs-string">&apos;budget&apos;</span>)) ]
});
</code></pre>
<p>or with the array syntax:</p>
<pre><code class="lang-javascript">app.service(<span class="hljs-string">&apos;workOrders&apos;</span>).after({
  find: [ iff(isNotAdmin(), [hooks.remove(<span class="hljs-string">&apos;budget&apos;</span>), hooks.remove(<span class="hljs-string">&apos;password&apos;</span>)]
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>predicate</code> (<em>required</em>) - Determines if hookFuncs should be run or not.
If a function, <code>predicate</code> is called with the hook as its param.
It returns either a boolean or a Promise that evaluates to a boolean</li>
<li><code>hookFuncs</code> (<em>optional</em>) - Zero or more hook functions. 
They may include other conditional hooks. 
Or you can use an array of hook functions as the second parameter.</li>
</ul>
<p>See also iffElse, else, when, unless, isNot, isProvider.</p>
<blockquote>
<p><strong>This</strong> The predicate and hook functions in the if, else and iffElse hooks
will not be called with <code>this</code> set to the service.
Use <code>hook.service</code> instead.</p>
</blockquote>
<h2 id="iffelse">iffElse</h2>
<h3 id="iffelsepredicate-truehooks-falsehooks-source"><code>iffElse(predicate, trueHooks, falseHooks)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/iff-else.js" target="_blank">source</a></h3>
<p>Resolve the predicate to a boolean.
Run the first set of hooks sequentially if the result is truthy,
the second set otherwise.</p>
<ul>
<li>Used as a <code>before</code> or <code>after</code> hook.</li>
<li>Predicate may be a sync or async function.</li>
<li>Hooks to run may be sync, Promises or callbacks.</li>
<li><code>feathers-hooks</code> catches any errors thrown in the predicate or hook.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { iffElse, populate, serialize } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
app.service(<span class="hljs-string">&apos;purchaseOrders&apos;</span>).after({
  create: iffElse(() =&gt; { ... },
    [populate(poAccting), serialize( ... )],
    [populate(poReceiving), serialize( ... )]
  )
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>predicate</code> (<em>required</em>) - Determines if hookFuncs should be run or not.
If a function, <code>predicate</code> is called with the hook as its param.
It returns either a boolean or a Promise that evaluates to a boolean</li>
<li><code>trueHooks</code> (<em>optional</em>) - Zero or more hook functions run when <code>predicate</code> is truthy.</li>
<li><code>falseHooks</code> (<em>optional</em>) - Zero or more hook functions run when <code>predicate</code> is false.</li>
</ul>
<p>See also iff, else, when, unless, isNot, isProvider.</p>
<blockquote>
<p><strong>This</strong> The predicate and hook functions in the if, else and iffElse hooks
will not be called with <code>this</code> set to the service.
Use <code>hook.service</code> instead.</p>
</blockquote>
<h2 id="isnot">isNot</h2>
<h3 id="isnotpredicate-source"><code>isNot(predicate)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/is-not.js" target="_blank">source</a></h3>
<p>Negate the <code>predicate</code>.</p>
<ul>
<li>Used as a predicate with conditional hooks.</li>
<li>Predicate may be a sync or async function.</li>
<li><code>feathers-hooks</code> catches any errors thrown in the predicate.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> hooks, { iff, isNot, isProvider } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;
<span class="hljs-keyword">const</span> isRequestor = () =&gt; hook =&gt; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(resolve, reject) =&gt; ... );

app.service(<span class="hljs-string">&apos;workOrders&apos;</span>).after({
  iff(isNot(isRequestor()), hooks.remove( ... ))
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>predicate</code> (<em>required</em>) - A function which returns either a boolean or a Promise that resolves to a boolean.</li>
</ul>
<p>See also iff, iffElse, else, when, unless, isProvider.</p>
<h2 id="isprovider">isProvider</h2>
<h3 id="isproviderprovider-source"><code>isProvider(provider)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/is-provider.js" target="_blank">source</a></h3>
<p>Check which transport called the service method.
All providers (<a href="rest.html">REST</a>, <a href="socketio.html">Socket.io</a> and <a href="primus.html">Primus</a>) set the <code>params.provider</code> property which is what <code>isProvider</code> checks for.</p>
<ul>
<li>Used as a predicate function with conditional hooks.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { iff, isProvider, remove } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;

app.service(<span class="hljs-string">&apos;users&apos;</span>).after({
  iff(isProvider(<span class="hljs-string">&apos;external&apos;</span>), remove( ... ))
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>provider</code> (<em>required</em>) - The transport that you want this hook to run for. Options are:<ul>
<li><code>server</code> - Run the hook if the server called the service method.</li>
<li><code>external</code> - Run the hook if any transport other than the server called the service method.</li>
<li><code>socketio</code> - Run the hook if the Socket.IO provider called the service method.</li>
<li><code>primus</code> - If the Primus provider.</li>
<li><code>rest</code> - If the REST provider.</li>
</ul>
</li>
<li><code>providers</code> (<em>optional</em>) - Other transports that you want this hook to run for.</li>
</ul>
<p>See also iff, iffElse, else, when, unless, isNot, isProvider.</p>
<h2 id="lowercase">lowerCase</h2>
<h3 id="lowercase-fieldnames-source"><code>lowerCase(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/lower-case.js" target="_blank">source</a></h3>
<p>Lower cases the given fields either in the data submitted or in the result. If the data is an array or a paginated <code>find</code> result the hook will lowercase the field(s) for every item.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
<li>Used as an <code>after</code> hook.</li>
<li>Field names support dot notation.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { lowerCase } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// lowercase the `email` and `password` field before a user is created</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  create: lowerCase(<span class="hljs-string">&apos;email&apos;</span>, <span class="hljs-string">&apos;username&apos;</span>)
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>required</em>) - One or more fields that you want to lowercase from the retrieved object(s).</li>
</ul>
<p>See also upperCase.</p>
<h2 id="paramsfromclient">paramsFromClient</h2>
<h3 id="paramsfromclient-whitelist-source"><code>paramsFromClient(... whitelist)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/params-from-client.js" target="_blank">source</a></h3>
<p>A hook, on the server, for passing <code>params</code> from the client to the server.</p>
<ul>
<li>Used as a <code>before</code> hook.</li>
<li>Companion to the client utility function <code>paramsForServer</code>.</li>
</ul>
<p>By default, only the <code>hook.params.query</code> object is transferred
to the server from a Feathers client,
for security among other reasons.
However you can explicitly transfer other <code>params</code> props with
the client utility function <code>paramsForServer</code> in conjunction with
the hook function <code>paramsFromClient</code> on the server.</p>
<pre><code class="lang-js"><span class="hljs-comment">// client</span>
<span class="hljs-keyword">import</span> { paramsForServer } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;
service.patch(<span class="hljs-literal">null</span>, data, paramsForServer({
  query: { dept: <span class="hljs-string">&apos;a&apos;</span> }, populate: <span class="hljs-string">&apos;po-1&apos;</span>, serialize: <span class="hljs-string">&apos;po-mgr&apos;</span>
}));

<span class="hljs-comment">// server</span>
<span class="hljs-keyword">const</span> { paramsFromClient } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
service.before({ all: [
  paramsFromClient(<span class="hljs-string">&apos;populate&apos;</span>, <span class="hljs-string">&apos;serialize&apos;</span>, <span class="hljs-string">&apos;otherProp&apos;</span>), myHook
]});

<span class="hljs-comment">// hook.params will now be</span>
<span class="hljs-comment">// { query: { dept: &apos;a&apos; }, populate: &apos;po-1&apos;, serialize: &apos;po-mgr&apos; } }</span>
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>whitelist</code> (<em>optional</em>) Names of the permitted props;
other props are ignored. This is a security feature.</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> You can use the same technique for service calls made on the server.</p>
</blockquote>
<p>See <code>util: paramsForServer</code>.</p>
<h2 id="pluck">pluck</h2>
<h3 id="pluck-fieldnames-source"><code>pluck(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/pluck.js" target="_blank">source</a></h3>
<p>Discard all other fields except for the provided fields either from the data submitted or from the result. If the data is an array or a paginated <code>find</code> result the hook will remove the field(s) for every item.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
<li>Used as an <code>after</code> hook.</li>
<li>Field names support dot notation.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { pluck } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// Only retain the hashed `password` and `salt` field after all method calls</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).after(pluck(<span class="hljs-string">&apos;password&apos;</span>, <span class="hljs-string">&apos;salt&apos;</span>));

<span class="hljs-comment">// Only keep the _id for `create`, `update` and `patch`</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  create: pluck(<span class="hljs-string">&apos;_id&apos;</span>),
  update: pluck(<span class="hljs-string">&apos;_id&apos;</span>),
  patch: pluck(<span class="hljs-string">&apos;_id&apos;</span>)
})
</code></pre>
<blockquote>
<p><strong>ProTip:</strong> This hook will only fire when <code>params.provider</code> has a value, i.e. when it is an external request over REST or Sockets.</p>
</blockquote>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>required</em>) - One or more fields that you want to retain from the object(s).</li>
</ul>
<p>All other fields will be discarded.</p>
<h2 id="pluckquery">pluckQuery</h2>
<p><code>pluckQuery(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/pluck-query.js" target="_blank">source</a></p>
<p>Discard all other fields except for the given fields from the query params.</p>
<ul>
<li>Used as a <code>before</code> hook.</li>
<li>Field names support dot notation.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { pluckQuery } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// Discard all other fields except for _id from the query</span>
<span class="hljs-comment">// for all service methods</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  all: pluckQuery(<span class="hljs-string">&apos;_id&apos;</span>)
});
</code></pre>
<blockquote>
<p><strong>ProTip:</strong> This hook will only fire when <code>params.provider</code> has a value, i.e. when it is an external request over REST or Sockets.</p>
</blockquote>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>optional</em>) - The fields that you want to retain from the query object. All other fields will be discarded.</li>
</ul>
<h2 id="populate">populate</h2>
<h3 id="populateoptions-object-hookfunc-source"><code>populate(options: Object): HookFunc</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/populate.js" target="_blank">source</a></h3>
<p>Populates items <em>recursively</em> to any depth. Supports 1:1, 1:n and n:1 relationships.</p>
<ul>
<li>Used as a <strong>before</strong> or <strong>after</strong> hook on any service method.</li>
<li>Supports multiple result items, including paginated <code>find</code>.</li>
<li>Permissions control what a user may see.</li>
<li>Provides performance profile information.</li>
<li>Backward compatible with the old FeathersJS <code>populate</code> hook.</li>
</ul>
<h4 id="examples">Examples</h4>
<ul>
<li>1:1 relationship</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-comment">// users like { _id: &apos;111&apos;, name: &apos;John&apos;, roleId: &apos;555&apos; }</span>
<span class="hljs-comment">// roles like { _id: &apos;555&apos;, permissions: [&apos;foo&apos;, bar&apos;] }</span>
<span class="hljs-keyword">import</span> { populate } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;

<span class="hljs-keyword">const</span> userRoleSchema = {
  include: {
    service: <span class="hljs-string">&apos;roles&apos;</span>,
    nameAs: <span class="hljs-string">&apos;role&apos;</span>,
    parentField: <span class="hljs-string">&apos;roleId&apos;</span>,
    childField: <span class="hljs-string">&apos;_id&apos;</span>
  }
};

app.service(<span class="hljs-string">&apos;users&apos;</span>).hooks({
  after: {
    all: populate({ schema: userRoleSchema })
  }
});

<span class="hljs-comment">// result like</span>
<span class="hljs-comment">// { _id: &apos;111&apos;, name: &apos;John&apos;, roleId: &apos;555&apos;,</span>
<span class="hljs-comment">//   role: { _id: &apos;555&apos;, permissions: [&apos;foo&apos;, bar&apos;] } }</span>
</code></pre>
<ul>
<li>1:n relationship</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-comment">// users like { _id: &apos;111&apos;, name: &apos;John&apos;, roleIds: [&apos;555&apos;, &apos;666&apos;] }</span>
<span class="hljs-comment">// roles like { _id: &apos;555&apos;, permissions: [&apos;foo&apos;, &apos;bar&apos;] }</span>
<span class="hljs-keyword">const</span> userRolesSchema = {
  include: {
    service: <span class="hljs-string">&apos;roles&apos;</span>,
    nameAs: <span class="hljs-string">&apos;roles&apos;</span>,
    parentField: <span class="hljs-string">&apos;roleIds&apos;</span>,
    childField: <span class="hljs-string">&apos;_id&apos;</span>
  }
};

usersService.hooks({
  after: {
    all: populate({ schema: userRolesSchema })
  }
});

<span class="hljs-comment">// result like</span>
<span class="hljs-comment">// { _id: &apos;111&apos;, name: &apos;John&apos;, roleIds: [&apos;555&apos;, &apos;666&apos;], roles: [</span>
<span class="hljs-comment">//   { _id: &apos;555&apos;, permissions: [&apos;foo&apos;, &apos;bar&apos;] }</span>
<span class="hljs-comment">//   { _id: &apos;666&apos;, permissions: [&apos;fiz&apos;, &apos;buz&apos;] }</span>
<span class="hljs-comment">// ]}</span>
</code></pre>
<ul>
<li>n:1 relationship</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-comment">// posts like { _id: &apos;111&apos;, body: &apos;...&apos; }</span>
<span class="hljs-comment">// comments like { _id: &apos;555&apos;, text: &apos;...&apos;, postId: &apos;111&apos; }</span>
<span class="hljs-keyword">const</span> postCommentsSchema = {
  include: {
    service: <span class="hljs-string">&apos;comments&apos;</span>,
    nameAs: <span class="hljs-string">&apos;comments&apos;</span>,
    parentField: <span class="hljs-string">&apos;_id&apos;</span>,
    childField: <span class="hljs-string">&apos;postId&apos;</span>
  }
};

postService.hooks({
  after: {
    all: populate({ schema: postCommentsSchema })
  }
});

<span class="hljs-comment">// result like</span>
<span class="hljs-comment">// { _id: &apos;111&apos;, body: &apos;...&apos; }, comments: [</span>
<span class="hljs-comment">//   { _id: &apos;555&apos;, text: &apos;...&apos;, postId: &apos;111&apos; }</span>
<span class="hljs-comment">//   { _id: &apos;666&apos;, text: &apos;...&apos;, postId: &apos;111&apos; }</span>
<span class="hljs-comment">// ]}</span>
</code></pre>
<ul>
<li>Multiple and recursive includes</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> schema = {
  service: <span class="hljs-string">&apos;...&apos;</span>,
  permissions: <span class="hljs-string">&apos;...&apos;</span>,
  include: [
    {
      service: <span class="hljs-string">&apos;users&apos;</span>,
      nameAs: <span class="hljs-string">&apos;authorItem&apos;</span>,
      parentField: <span class="hljs-string">&apos;author&apos;</span>,
      childField: <span class="hljs-string">&apos;id&apos;</span>,
      include: [ ... ],
    },
    {
      service: <span class="hljs-string">&apos;comments&apos;</span>,
      parentField: <span class="hljs-string">&apos;id&apos;</span>,
      childField: <span class="hljs-string">&apos;postId&apos;</span>,
      query: {
        $limit: <span class="hljs-number">5</span>,
        $select: [<span class="hljs-string">&apos;title&apos;</span>, <span class="hljs-string">&apos;content&apos;</span>, <span class="hljs-string">&apos;postId&apos;</span>],
        $sort: {createdAt: <span class="hljs-number">-1</span>}
      },
      select: (hook, parent, depth) =&gt; ({ $limit: <span class="hljs-number">6</span> }),
      asArray: <span class="hljs-literal">true</span>,
      provider: <span class="hljs-literal">undefined</span>,
    },
    {
      service: <span class="hljs-string">&apos;users&apos;</span>,
      permissions: <span class="hljs-string">&apos;...&apos;</span>,
      nameAs: <span class="hljs-string">&apos;readers&apos;</span>,
      parentField: <span class="hljs-string">&apos;readers&apos;</span>,
      childField: <span class="hljs-string">&apos;id&apos;</span>
    }
  ],
};

<span class="hljs-built_in">module</span>.exports.after = {
  all: populate({ schema, checkPermissions, profile: <span class="hljs-literal">true</span> })
};
</code></pre>
<ul>
<li>Flexible relationship, similar to the n:1 relationship example above</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-comment">// posts like { _id: &apos;111&apos;, body: &apos;...&apos; }</span>
<span class="hljs-comment">// comments like { _id: &apos;555&apos;, text: &apos;...&apos;, postId: &apos;111&apos; }</span>
<span class="hljs-keyword">const</span> postCommentsSchema = {
  include: {
    service: <span class="hljs-string">&apos;comments&apos;</span>,
    nameAs: <span class="hljs-string">&apos;comments&apos;</span>,
    select: (hook, parentItem) =&gt; ({ postId: parentItem._id }),
  }
};

postService.hooks({
  after: {
    all: populate({ schema: postCommentsSchema })
  }
});

<span class="hljs-comment">// result like</span>
<span class="hljs-comment">// { _id: &apos;111&apos;, body: &apos;...&apos; }, comments: [</span>
<span class="hljs-comment">//   { _id: &apos;555&apos;, text: &apos;...&apos;, postId: &apos;111&apos; }</span>
<span class="hljs-comment">//   { _id: &apos;666&apos;, text: &apos;...&apos;, postId: &apos;111&apos; }</span>
<span class="hljs-comment">// ]}</span>
</code></pre>
<h4 id="options">Options</h4>
<ul>
<li><code>schema</code> (<em>required</em>, object or function) How to populate the items. <a href="#schema">Details are below.</a><ul>
<li>Function signature <code>(hook: Hook, options: Object): Object</code></li>
<li><code>hook</code> The hook.</li>
<li><code>options</code> The <code>options</code> passed to the populate hook.</li>
</ul>
</li>
<li><code>checkPermissions</code> [optional, default () =&gt; true] Function to check if the user is allowed to perform this populate,
or include this type of item. Called whenever a <code>permissions</code> property is found.<ul>
<li>Function signature <code>(hook: Hook, service: string, permissions: any, depth: number): boolean</code></li>
<li><code>hook</code> The hook.</li>
<li><code>service</code> The name of the service being included, e.g. users, messages.</li>
<li><code>permissions</code> The value of the permissions property.</li>
<li><code>depth</code> How deep the include is in the schema. Top of schema is 0.</li>
<li>Return truesy to allow the include.</li>
</ul>
</li>
<li><code>profile</code> [optional, default false] If <code>true</code>, the populated result is to contain a performance profile.
Must be <code>true</code>, truesy is insufficient.</li>
</ul>
<h4 id="schema">Schema</h4>
<p>The data currently in the hook will be populated according to the schema. The schema starts with:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> schema = {
  service: <span class="hljs-string">&apos;...&apos;</span>,
  permissions: <span class="hljs-string">&apos;...&apos;</span>,
  include: [ ... ]
};
</code></pre>
<ul>
<li><code>service</code> (<em>optional</em>) The name of the service this schema is to be used with.
This can be used to prevent a schema designed to populate &apos;blog&apos; items
from being incorrectly used with <code>comment</code> items.</li>
<li><code>permissions</code> (<em>optional</em>, any type of value) Who is allowed to perform this populate. See <code>checkPermissions</code> above.</li>
<li><code>include</code> (<em>optional</em>) Which services to join to the data.</li>
</ul>
<h5 id="include">Include</h5>
<p>The <code>include</code> array has an element for each service to join. They each may have:</p>
<pre><code class="lang-javascript">{ service: <span class="hljs-string">&apos;comments&apos;</span>,
  nameAs: <span class="hljs-string">&apos;commentItems&apos;</span>,
  permissions: <span class="hljs-string">&apos;...&apos;</span>,
  parentField: <span class="hljs-string">&apos;id&apos;</span>,
  childField: <span class="hljs-string">&apos;postId&apos;</span>,
  query: {
    $limit: <span class="hljs-number">5</span>,
    $select: [<span class="hljs-string">&apos;title&apos;</span>, <span class="hljs-string">&apos;content&apos;</span>, <span class="hljs-string">&apos;postId&apos;</span>],
    $sort: {createdAt: <span class="hljs-number">-1</span>}
  },
  select: (hook, parent, depth) =&gt; ({ $limit: <span class="hljs-number">6</span> }),
  asArray: <span class="hljs-literal">true</span>,
  paginate: <span class="hljs-literal">false</span>,
  provider: <span class="hljs-literal">undefined</span>,
  useInnerPopulate: <span class="hljs-literal">false</span>,
  include: [ ... ]
}
</code></pre>
<blockquote>
<p><strong>ProTip</strong> Instead of setting <code>include</code> to a 1-element array,
you can set it to the include object itself,
e.g. <code>include: { service: ..., nameAs: ..., ... }</code>.</p>
</blockquote>
<ul>
<li><code>service</code> [required, string] The name of the service providing the items.</li>
<li><code>nameAs</code> [optional, string, default is service] Where to place the items from the join.
Dot notation is allowed.</li>
<li><code>permissions</code> [optional, any type of value] Who is allowed to perform this join. See <code>checkPermissions</code> above.</li>
<li><code>parentField</code> [required if neither query nor select, string] The name of the field in the parent item for the <a href="#relation">relation</a>.
Dot notation is allowed.</li>
<li><code>childField</code> [required if neither query nor select, string] The name of the field in the child item for the <a href="#relation">relation</a>.
Dot notation is allowed and will result in a query like <code>{ &apos;name.first&apos;: &apos;John&apos; }</code>
which is not suitable for all DBs.
You may use <code>query</code> or <code>select</code> to create a query suitable for your DB.</li>
<li><code>query</code> [optional, object] An object to inject into the query in <code>service.find({ query: { ... } })</code>.</li>
<li><code>select</code> [optional, function] A function whose result is injected into the query.<ul>
<li>Function signature <code>(hook: Hook, parentItem: Object, depth: number): Object</code></li>
<li><code>hook</code> The hook.</li>
<li><code>parentItem</code> The parent item to which we are joining.</li>
<li><code>depth</code> How deep the include is in the schema. Top of schema is 0.</li>
</ul>
</li>
<li><code>asArray</code> [optional, boolean, default false] Force a single joined item to be stored as an array.</li>
<li><code>paginate</code> {optional, boolean or number, default false]
Controls pagination for this service.<ul>
<li><code>false</code> No pagination. The default.</li>
<li><code>true</code> Use the configuration provided when the service was configured/</li>
<li>A number. The maximum number of items to include.</li>
</ul>
</li>
<li><code>provider</code> [optional] <code>find</code> calls are made to obtain the items to be joined.
These, by default, are initialized to look like they were made
by the same provider as that getting the base record.
So when populating the result of a call made via <code>socketio</code>,
all the join calls will look like they were made via <code>socketio</code>.
Alternative you can set <code>provider: undefined</code> and the calls for that join will
look like they were made by the server.
The hooks on the service may behave differently in different situations.</li>
<li><code>useInnerPopulate</code> [optional] Populate, when including records from a child service,
ignores any populate hooks defined for that child service.
The useInnerPopulate option will run those populate hooks.
This allows the populate for a base record to include child records
containing their own immediate child records,
without the populate for the base record knowing what those grandchildren populates are.</li>
<li><code>include</code> [optional] The new items may themselves include other items. The includes are recursive.</li>
</ul>
<p>Populate forms the query <code>[childField]: parentItem[parentField]</code> when the parent value is not an array.
This will include all child items having that value.</p>
<p>Populate forms the query <code>[childField]: { $in: parentItem[parentField] }</code> when the parent value is an array.
This will include all child items having any of those values.</p>
<p>A populate hook for, say, <code>posts</code> may include items from <code>users</code>.
Should the <code>users</code> hooks also include a populate,
that <code>users</code> populate hook will not be run for includes arising from <code>posts</code>.</p>
<blockquote>
<p><strong>ProTip</strong> The populate interface only allows you to directly manipulate <code>hook.params.query</code>.
You can manipulate the rest of <code>hook.params</code> by using the
<a href="https://docs.feathersjs.com/v/auk/hooks/common/utils.html#client" target="_blank"><code>client</code></a> hook,
along with something like <code>query: { ..., $client: { paramsProp1: ..., paramsProp2: ... } }</code>.</p>
</blockquote>
<h4 id="added-properties">Added properties</h4>
<p>Some additional properties are added to populated items. The result may look like:</p>
<pre><code class="lang-javascript">{ ...
  _include: [ <span class="hljs-string">&apos;post&apos;</span> ],
  _elapsed: { post: <span class="hljs-number">487947</span>, total: <span class="hljs-number">527118</span> },
  post:
    { ...
      _include: [ <span class="hljs-string">&apos;authorItem&apos;</span>, <span class="hljs-string">&apos;commentsInfo&apos;</span>, <span class="hljs-string">&apos;readersInfo&apos;</span> ],
      _elapsed: { authorItem: <span class="hljs-number">321973</span>, commentsInfo: <span class="hljs-number">469375</span>, readersInfo: <span class="hljs-number">479874</span>, total: <span class="hljs-number">487947</span> },
      _computed: [ <span class="hljs-string">&apos;averageStars&apos;</span>, <span class="hljs-string">&apos;views&apos;</span> ],
      authorItem: { ... },
      commentsInfo: [ { ... }, { ... } ],
      readersInfo: [ { ... }, { ... } ]
} }
</code></pre>
<ul>
<li><code>_include</code> The property names containing joined items.</li>
<li><code>_elapsed</code> The elapsed time in nano-seconds (where 1,000,000 ns === 1 ms) taken to perform each include,
as well as the total taken for them all.
This delay is mostly attributed to your DB.</li>
<li><code>_computed</code> The property names containing values computed by the <code>serialize</code> hook.</li>
</ul>
<p>The <a href="#depopulate">depopulate</a> hook uses these fields to remove all joined and computed values.
This allows you to then <code>service.patch()</code> the item in the hook.</p>
<h4 id="joining-without-using-related-fields">Joining without using related fields</h4>
<p>Populate can join child records to a parent record using the related columns
<code>parentField</code> and <code>childField</code>.
However populate&apos;s <code>query</code> and <code>select</code> options may be used to related the
records without needing to use the related columns.
This is a more flexible, non-SQL-like way of relating records.
It easily supports dynamic, run-time schemas since the <code>select</code> option may be
a function.</p>
<h4 id="populate-examples">Populate examples</h4>
<h5 id="selecting-schema-based-on-ui-needs">Selecting schema based on UI needs</h5>
<p>Consider a Purchase Order item.
An Accounting oriented UI will likely want to populate the PO with Invoice items.
A Receiving oriented UI will likely want to populate with Receiving Slips.</p>
<p>Using a function for <code>schema</code> allows you to select an appropriate schema based on the need.
The following example shows how the client can ask for the type of schema it needs.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// on client</span>
<span class="hljs-keyword">import</span> { paramsForServer } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;
purchaseOrders.get(id, paramsForServer({ schema: <span class="hljs-string">&apos;po-acct&apos;</span> })); <span class="hljs-comment">// pass schema name to server</span>
<span class="hljs-comment">// or</span>
purchaseOrders.get(id, paramsForServer({ schema: <span class="hljs-string">&apos;po-rec&apos;</span> }));
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// on server</span>
<span class="hljs-keyword">import</span> { paramsFromClient } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;
<span class="hljs-keyword">const</span> poSchemas = {
  <span class="hljs-string">&apos;po-acct&apos;</span>: <span class="hljs-comment">/* populate schema for Accounting oriented PO e.g. { include: ... } */</span>,
  <span class="hljs-string">&apos;po-rec&apos;</span>: <span class="hljs-comment">/* populate schema for Receiving oriented PO */</span>
};

purchaseOrders.before({
  all: paramsfromClient(<span class="hljs-string">&apos;schema&apos;</span>)
});

purchaseOrders.after({
  all: populate({ schema: hook =&gt; poSchemas[hook.params.schema] }),
});
</code></pre>
<h5 id="using-permissions">Using permissions</h5>
<p>For a simplistic example,
assume <code>hook.params.users.permissions</code> is an array of the service names the user may use,
e.g. <code>[&apos;invoices&apos;, &apos;billings&apos;]</code>.
These can be used to control which types of items the user can see.</p>
<p>The following populate will only be performed for users whose <code>user.permissions</code> contains <code>&apos;invoices&apos;</code>.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> schema = {
  include: [
    {
      service: <span class="hljs-string">&apos;invoices&apos;</span>,
      permissions: <span class="hljs-string">&apos;invoices&apos;</span>,
      ...
    }
  ]
};

purchaseOrders.after({
  all: populate(schema, (hook, service, permissions) =&gt; hook.params.user.permissions.includes(service))
});
</code></pre>
<p>See also dePopulate, serialize.</p>
<h2 id="preventchanges">preventChanges</h2>
<h3 id="preventchanges-fieldnames-source"><code>preventChanges(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/prevent-changes.js" target="_blank">source</a></h3>
<p>Prevents the specified fields from being patched.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>patch</code>.</li>
<li>Field names support dot notation e.g. <code>name.address.city</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { preventChanges } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  patch: preventChanges(<span class="hljs-string">&apos;security.badge&apos;</span>)
})
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>required</em>) - One or more fields which may not be patched.</li>
</ul>
<blockquote>
<p>Consider using <code>verifySchema</code> if you would rather specify which fields are allowed to change.</p>
</blockquote>
<h2 id="remove">remove</h2>
<h3 id="remove-fieldnames-source"><code>remove(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/remove.js" target="_blank">source</a></h3>
<p>Remove the given fields either from the data submitted or from the result. If the data is an array or a paginated <code>find</code> result the hook will remove the field(s) for every item.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
<li>Used as an <code>after</code> hook.</li>
<li>Field names support dot notation e.g. <code>name.address.city</code>.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { remove } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// Remove the hashed `password` and `salt` field after all method calls</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).after(remove(<span class="hljs-string">&apos;password&apos;</span>, <span class="hljs-string">&apos;salt&apos;</span>));

<span class="hljs-comment">// Remove _id for `create`, `update` and `patch`</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  create: remove(<span class="hljs-string">&apos;_id&apos;</span>, <span class="hljs-string">&apos;password&apos;</span>),
  update: remove(<span class="hljs-string">&apos;_id&apos;</span>),
  patch: remove(<span class="hljs-string">&apos;_id&apos;</span>)
})
</code></pre>
<blockquote>
<p><strong>ProTip:</strong> This hook will only fire when <code>params.provider</code> has a value, i.e. when it is an external request over REST or Sockets.</p>
</blockquote>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>required</em>) - One or more fields you want to remove from the object(s).</li>
</ul>
<p>See also discard.</p>
<h2 id="removequery">removeQuery</h2>
<p><code>removeQuery(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/remove-query.js" target="_blank">source</a></p>
<p>Remove the given fields from the query params.</p>
<ul>
<li>Used as a <code>before</code> hook.</li>
<li>Field names support dot notation</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { removeQuery } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// Remove _id from the query for all service methods</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  all: removeQuery(<span class="hljs-string">&apos;_id&apos;</span>)
});
</code></pre>
<blockquote>
<p><strong>ProTip:</strong> This hook will only fire when <code>params.provider</code> has a value, i.e. when it is an external request over REST or Sockets.</p>
</blockquote>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>optional</em>) - The fields that you want to remove from the query object.</li>
</ul>
<h2 id="serialize">serialize</h2>
<h3 id="serializeschema-objectfunction-hookfunc-source"><code>serialize(schema: Object|Function): HookFunc</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/serialize.js" target="_blank">source</a></h3>
<p>Remove selected information from populated items. Add new computed information.
Intended for use with the <code>populate</code> hook.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> schema = {
  only: <span class="hljs-string">&apos;updatedAt&apos;</span>,
  computed: {
    commentsCount: (recommendation, hook) =&gt; recommendation.post.commentsInfo.length,
  },
  post: {
    exclude: [<span class="hljs-string">&apos;id&apos;</span>, <span class="hljs-string">&apos;createdAt&apos;</span>, <span class="hljs-string">&apos;author&apos;</span>, <span class="hljs-string">&apos;readers&apos;</span>],
    authorItem: {
      exclude: [<span class="hljs-string">&apos;id&apos;</span>, <span class="hljs-string">&apos;password&apos;</span>, <span class="hljs-string">&apos;age&apos;</span>],
      computed: {
        isUnder18: (authorItem, hook) =&gt; authorItem.age &lt; <span class="hljs-number">18</span>,
      },
    },
    readersInfo: {
      exclude: <span class="hljs-string">&apos;id&apos;</span>,
    },
    commentsInfo: {
      only: [<span class="hljs-string">&apos;title&apos;</span>, <span class="hljs-string">&apos;content&apos;</span>],
      exclude: <span class="hljs-string">&apos;content&apos;</span>,
    },
  },
};
purchaseOrders.after({
  all: [ populate( ... ), serialize(schema) ]
});
</code></pre>
<p>Options</p>
<ul>
<li><code>schema</code> [required, object or function] How to serialize the items.<ul>
<li>Function signature <code>(hook: Hook): Object</code></li>
<li><code>hook</code> The hook.</li>
</ul>
</li>
</ul>
<p>The schema reflects the structure of the populated items.
The base items for the example above have <a href="#include">included</a> <code>post</code> items,
which themselves have included <code>authorItem</code>, <code>readersInfo</code> and <code>commentsInfo</code> items.</p>
<p>The schema for each set of items may have</p>
<ul>
<li><code>only</code> [optional, string or array of strings] The names of the fields to keep in each item.
The names for included sets of items plus <code>_include</code> and <code>_elapsed</code> are not removed by <code>only</code>.</li>
<li><code>exclude</code> [optional, string or array of strings] The names of fields to drop in each item.
You may drop, at your own risk, names of included sets of items, <code>_include</code> and <code>_elapsed</code>.</li>
<li><code>computed</code> [optional, object with functions] The new names you want added and how to compute their values.<ul>
<li>Object is like <code>{ name: func, ...}</code></li>
<li><code>name</code> The name of the field to add to the items.</li>
<li><code>func</code> Function with signature <code>(item, hook)</code>.<ul>
<li><code>item</code> The item with all its initial values, plus all of its included items.
The function can still reference values which will be later removed by <code>only</code> and <code>exclude</code>.</li>
<li><code>hook</code> The hook passed to serialize.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="serialize-examples">Serialize examples</h4>
<h5 id="a-simple-serialize">A simple serialize</h5>
<p>The populate <a href="#a-simple-populate">example above</a> produced the result</p>
<pre><code class="lang-javascript">{ id: <span class="hljs-number">9</span>, title: <span class="hljs-string">&apos;The unbearable ligthness of FeathersJS&apos;</span>, author: <span class="hljs-number">5</span>, yearBorn: <span class="hljs-number">1990</span>,
  authorItem: { id: <span class="hljs-number">5</span>, email: <span class="hljs-string">&apos;john.doe@gmail.com&apos;</span>, name: <span class="hljs-string">&apos;John Doe&apos;</span> },
  _include: [<span class="hljs-string">&apos;authorItem&apos;</span>]
}
</code></pre>
<p>We could tailor the result more to what we need with:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> serializeSchema = {
  only: [<span class="hljs-string">&apos;title&apos;</span>],
  authorItem: {
    only: [<span class="hljs-string">&apos;name&apos;</span>]
    computed: {
      isOver18: (authorItem, hook) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getFullYear() - authorItem.yearBorn &gt;= <span class="hljs-number">18</span>,
    },
  }
};
app.service(<span class="hljs-string">&apos;posts&apos;</span>).before({
  get: [ hooks.populate({ schema }), serialize(serializeSchema) ],
  find: [ hooks.populate({ schema }), serialize(serializeSchema) ]
});
</code></pre>
<p>The result would now be</p>
<pre><code class="lang-javascript">{ title: <span class="hljs-string">&apos;The unbearable ligthness of FeathersJS&apos;</span>,
  authorItem: { name: <span class="hljs-string">&apos;John Doe&apos;</span>, isOver18: <span class="hljs-literal">true</span>, _computed: [<span class="hljs-string">&apos;isOver18&apos;</span>] },
  _include: [<span class="hljs-string">&apos;authorItem&apos;</span>],
}
</code></pre>
<h5 id="using-permissions">Using permissions</h5>
<p>Consider an Employee item.
The Payroll Manager would be permitted to see the salaries of other department heads.
No other person would be allowed to see them.</p>
<p>Using a function for <code>schema</code> allows you to select an appropriate schema based on the need.</p>
<p>Assume <code>hook.params.user.roles</code> contains an array of roles which the user performs.
The Employee item can be serialized differently for the Payroll Manager than for anyone else.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> payrollSerialize = {
  <span class="hljs-string">&apos;payrollMgr&apos;</span>: { <span class="hljs-comment">/* serialization schema for Payroll Manager */</span>},
  <span class="hljs-string">&apos;payroll&apos;</span>: { <span class="hljs-comment">/* serialization schema for others */</span>}
};

employees.after({
  all: [
    populate( ... ),
    serialize(hook =&gt; payrollSerialize[
      hook.params.user.roles.contains(<span class="hljs-string">&apos;payrollMgr&apos;</span>) ? <span class="hljs-string">&apos;payrollMgr&apos;</span> : <span class="hljs-string">&apos;payroll&apos;</span>
    ])    
  ]
});
</code></pre>
<h2 id="setcreatedat">setCreatedAt</h2>
<h3 id="setcreatedatfieldname--createdat--fieldnames-source"><code>setCreatedAt(fieldName = &apos;createdAt&apos;, ... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/set-created-at.js" target="_blank">source</a></h3>
<p>Add the fields with the current date-time.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
<li>Used as an <code>after</code> hook.</li>
<li>Field names support dot notation.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> <code>setCreatedAt</code> will be deprecated, so use <code>setNow</code> instead.</p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { setCreatedAt } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// set the `createdAt` field before a user is created</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  create: [ setCreatedAt() ]
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldName</code> (<em>optional</em>, default: <code>createdAt</code>) - The field that you want to add with the current date-time to the retrieved object(s).</li>
<li><code>fieldNames</code> (<em>optional</em>) - Other fields to add with the current date-time.</li>
</ul>
<p>See also setUpdatedAt.</p>
<h2 id="setnow">setNow</h2>
<h3 id="setnow-fieldnames-source"><code>setNow(... fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/set-now.js" target="_blank">source</a></h3>
<p>Add the fields with the current date-time.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
<li>Used as an <code>after</code> hook.</li>
<li>Field names support dot notation.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { setNow } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  create: setNow(<span class="hljs-string">&apos;createdAt&apos;</span>, <span class="hljs-string">&apos;updatedAt&apos;</span>)
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldNames</code> (<em>required</em>, at least one) - The fields that you want to add with the current date-time to the retrieved object(s).</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> Use <code>setNow</code> rather than <code>setCreatedAt</code> or <code>setUpdatedAt</code>.</p>
</blockquote>
<h2 id="setslug">setSlug</h2>
<h3 id="setslugslug-fieldname--query--slug-source"><code>setSlug(slug, fieldName = &apos;query.&apos; + slug)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/set-slug.js" target="_blank">source</a></h3>
<p>A service may have a slug in its URL, e.g. <code>storeId</code> in
<code>app.use(&apos;/stores/:storeId/candies&apos;, new Service());</code>.
The service gets slightly different values depending on the transport used by the client.</p>
<table>
<thead>
<tr>
<th>transport</th>
<th><code>hook.data.storeId</code></th>
<th><code>hook.params.query</code></th>
<th>code run on client</th>
</tr>
</thead>
<tbody>
<tr>
<td>socketio</td>
<td><code>undefined</code></td>
<td><code>{ size: &apos;large&apos;, storeId: &apos;123&apos; }</code></td>
<td><code>candies.create({ name: &apos;Gummi&apos;, qty: 100 }, { query: { size: &apos;large&apos;, storeId: &apos;123&apos; } })</code></td>
</tr>
<tr>
<td>rest</td>
<td><code>:storeId</code></td>
<td>... same as above</td>
<td>... same as above</td>
</tr>
<tr>
<td>raw HTTP</td>
<td><code>123</code></td>
<td><code>{ size: &apos;large&apos; }</code></td>
<td><code>fetch(&apos;/stores/123/candies?size=large&apos;, ..</code></td>
</tr>
</tbody>
</table>
<p>This hook normalizes the difference between the transports. A hook of
<code>all: [ hooks.setSlug(&apos;storeId&apos;) ]</code>
provides a normalized <code>hook.params.query</code> of
<code>{ size: &apos;large&apos;, storeId: &apos;123&apos; }</code> for the above cases.</p>
<ul>
<li>Used as a <code>before</code> hook.</li>
<li>Field names support dot notation.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { setSlug } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

app.service(<span class="hljs-string">&apos;stores&apos;</span>).before({
  create: [ setSlug(<span class="hljs-string">&apos;storeId&apos;</span>) ]
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>slug</code> (<em>required</em>) - The slug as it appears in the route, e.g. <code>storeId</code> for <code>/stores/:storeId/candies</code> .</li>
<li><code>fieldName</code> (<em>optional</em>, default: <code>query[slugId]</code>) - The field to contain the slug value.</li>
</ul>
<h2 id="setupdatedat">setUpdatedAt</h2>
<h3 id="setupdatedatfieldname--updatedat-fieldnames-source"><code>setUpdatedAt(fieldName = &apos;updatedAt&apos;, ...fieldNames)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/set-updated-at.js" target="_blank">source</a></h3>
<p>Add or update the fields with the current date-time.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
<li>Used as an <code>after</code> hook.</li>
<li>Field names support dot notation.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> <code>setUpdatedAt</code> will be deprecated, so use <code>setNow</code> instead.</p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { setUpdatedAt } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// set the `updatedAt` field before a user is created</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({
  create: [ setUpdatedAt() ]
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldName</code> (<em>optional</em>, default: <code>updatedAt</code>) - The fields that you want to add or update in the retrieved object(s).</li>
<li><code>fieldNames</code> (<em>optional</em>) - Other fields to add or update with the current date-time.</li>
</ul>
<p>See also setCreatedAt.</p>
<h2 id="sifter">sifter</h2>
<h3 id="siftermongoqueryfunc-source"><code>sifter(mongoQueryFunc))</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/sifter.js" target="_blank">source</a></h3>
<p>All official Feathers database adapters support a common way for querying,
sorting, limiting and selecting find method calls.
These are limited to what is commonly supported by all the databases.</p>
<p>The <code>sifter</code> hook provides an extensive MongoDB-like selection capabilities,
and it may be used to more extensively select records.</p>
<ul>
<li>Used as an <code>after</code> hook for <code>find</code>.</li>
<li>SProvides extensive MongoDB-like selection capabilities.</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> <code>sifter</code> filters the result of a <code>find</code> call.
Therefore more records will be physically read than needed.
You can use the Feathers database adapters <code>query</code> to reduce this number.</p>
</blockquote>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> sift = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;sift&apos;</span>);
<span class="hljs-keyword">const</span> { sifter } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-keyword">const</span> selectCountry = hook =&gt; sift({ <span class="hljs-string">&apos;address.country&apos;</span>: hook.params.country });

app.service(<span class="hljs-string">&apos;stores&apos;</span>).after({
  find: sifter(selectCountry),
});
</code></pre>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> sift = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;sift&apos;</span>);
<span class="hljs-keyword">const</span> { sifter } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-keyword">const</span> selectCountry = country =&gt; () =&gt; sift({ address : { country: country } });

app.service(<span class="hljs-string">&apos;stores&apos;</span>).after({
  find: sifter(selectCountry(<span class="hljs-string">&apos;Canada&apos;</span>)),
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>mongoQueryFunc</code> (<em>required</em>) - Function similar to <code>hook =&gt; sift(mongoQueryObj)</code>.
Information about the <code>mongoQueryObj</code> syntax is available at
<a href="https://github.com/crcn/sift.js" target="_blank">sift</a>.</li>
</ul>
<h2 id="softdelete">softDelete</h2>
<h3 id="softdeletefieldname--deleted-source"><code>softDelete(fieldName = &apos;deleted&apos;)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/soft-delete.js" target="_blank">source</a></h3>
<p>Marks items as <code>{ deleted: true }</code> instead of physically removing them.
This is useful when you want to discontinue use of, say, a department,
but you have historical information which continues to refer to the discontinued department.</p>
<ul>
<li>Used as a <code>before.all</code> hook to handle all service methods.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> { softDelete } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
<span class="hljs-keyword">const</span> dept = app.service(<span class="hljs-string">&apos;departments&apos;</span>);

dept.before({
  all: softDelete(),
});

<span class="hljs-comment">// will throw if item is marked deleted.</span>
dept.get(<span class="hljs-number">0</span>).then()

<span class="hljs-comment">// methods can be run avoiding softDelete handling</span>
dept.get(<span class="hljs-number">0</span>, { query: { $disableSoftDelete: <span class="hljs-literal">true</span> }}).then()
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>fieldName</code> (<em>optional</em>, default: <code>deleted</code>) - The name of the field holding the deleted flag.</li>
</ul>
<h2 id="some">some</h2>
<h3 id="some-hookfuncs-source"><code>some(... hookFuncs)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/some.js" target="_blank">source</a></h3>
<p>Run hook functions in parallel.
Return <code>true</code> if any hook function returned a truthy value.</p>
<ul>
<li>Used as a predicate function with conditional hooks.</li>
<li>The current <code>hook</code> is passed to all the hook functions, and they are run in parallel.</li>
<li>Hooks to run may be sync or Promises only.</li>
<li><code>feathers-hooks</code> catches any errors thrown in the predicate.</li>
</ul>
<pre><code class="lang-javascript">service.before({
  create: hooks.iff(hooks.some(hook1, hook2, ...), hookA, hookB, ...)
});
</code></pre>
<pre><code class="lang-javascript">hooks.some(hook1, hook2, ...).call(<span class="hljs-keyword">this</span>, currentHook)
  .then(bool =&gt; { ... });
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>hookFuncs</code> (<em>required</em>) Functions which take the current hook as a param and return a boolean result.</li>
</ul>
<p>See also every.</p>
<h2 id="stashbefore">stashBefore</h2>
<h3 id="stashbeforename-source"><code>stashBefore(name)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/stash-before.js" target="_blank">source</a></h3>
<p>Stash current value of record before mutating it.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>get</code>, <code>update</code>, <code>patch</code> or <code>remove</code>.</li>
<li>An <code>id</code> is required in the method call.</li>
</ul>
<pre><code class="lang-javascript">service.before({
  patch: stashBefore()
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>name</code> (<em>optional</em> defaults to &apos;before&apos;) The name of the params property
to contain the current record value.</li>
</ul>
<h2 id="traverse">traverse</h2>
<h3 id="traversetransformer-getobject-source"><code>traverse(transformer, getObject)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/traverse.js" target="_blank">source</a></h3>
<p>Traverse and transform objects in place by visiting every node on a recursive walk.</p>
<ul>
<li>Used as a <code>before</code> or <code>after</code> hook.</li>
<li>Supports multiple data items, including paginated <code>find</code>.</li>
<li>Any object in the hook may be traversed, <strong>including the query object</strong>.</li>
<li><code>transformer</code> has access to powerful methods and context.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-comment">// Trim strings</span>
<span class="hljs-keyword">const</span> trimmer = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> node === <span class="hljs-string">&apos;string&apos;</span>) { <span class="hljs-keyword">this</span>.update(node.trim()); }
};
service.before({ create: traverse(trimmer) });
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// REST HTTP request may use the string &apos;null&apos; in its query string.</span>
<span class="hljs-comment">// Replace these strings with the value null.</span>
<span class="hljs-keyword">const</span> nuller = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
  <span class="hljs-keyword">if</span> (node === <span class="hljs-string">&apos;null&apos;</span>) { <span class="hljs-keyword">this</span>.update(<span class="hljs-literal">null</span>); }
};
service.before({ find: traverse(nuller, hook =&gt; hook.params.query) });
</code></pre>
<blockquote>
<p><strong>ProTip:</strong> GitHub&apos;s <a href="https://github.com/substack/js-traverse" target="_blank">substack/js-traverse</a> documents the extensive methods and context available to the transformer function.</p>
</blockquote>
<p><strong>Options:</strong></p>
<ul>
<li><code>transformer</code> (<em>required</em>) - Called for every node and may change it in place.</li>
<li><code>getObject</code> (<em>optional</em>, defaults to <code>hook.data</code> or <code>hook.result</code>) -  Function with signature (hook) which returns the object to traverse.</li>
</ul>
<h2 id="unless">unless</h2>
<h3 id="unlesspredicate-hookfuncs-source"><code>unless(predicate, ...hookFuncs)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/unless.js" target="_blank">source</a></h3>
<p>Resolve the predicate to a boolean.
Run the hooks sequentially if the result is falsey.</p>
<ul>
<li>Used as a <code>before</code> or <code>after</code> hook.</li>
<li>Predicate may be a sync or async function.</li>
<li>Hooks to run may be sync, Promises or callbacks.</li>
<li><code>feathers-hooks</code> catches any errors thrown in the predicate or hook.</li>
</ul>
<pre><code class="lang-javascript">service.before({
  create:
    unless(isProvider(<span class="hljs-string">&apos;server&apos;</span>),
      hookA,
      unless(isProvider(<span class="hljs-string">&apos;rest&apos;</span>), hook1, hook2, hook3),
      hookB
    )
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>predicate</code> (<em>required</em>) - Determines if hookFuncs should be run or not.
If a function, <code>predicate</code> is called with the hook as its param.
It returns either a boolean or a Promise that evaluates to a boolean.</li>
<li><code>hookFuncs</code> (<em>optional</em>) - Zero or more hook functions.
They may include other conditional hook functions.</li>
</ul>
<p>See also iff, iffElse, else, when, isNot, isProvider.</p>
<h2 id="validate">validate</h2>
<h3 id="validatevalidator-source"><code>validate(validator)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/validate.js" target="_blank">source</a></h3>
<p>Call a validation function from a <code>before</code> hook. The function may be sync or return a Promise.</p>
<ul>
<li>Used as a <code>before</code> hook for <code>create</code>, <code>update</code> or <code>patch</code>.</li>
</ul>
<blockquote>
<p><strong>ProTip:</strong> If you have a different signature for the validator then pass a wrapper as the validator e.g. <code>(values) =&gt; myValidator(..., values, ...)</code>.</p>
</blockquote>
<!-- -->
<blockquote>
<p><strong>ProTip:</strong> Wrap your validator in <code>callbackToPromise</code> if it uses a callback.</p>
</blockquote>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { callbackToPromise, validate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-comment">// function myCallbackValidator(values, cb) { ... }</span>
<span class="hljs-keyword">const</span> myValidator = callbackToPromise(myCallbackValidator, <span class="hljs-number">1</span>); <span class="hljs-comment">// function requires 1 param</span>
app.service(<span class="hljs-string">&apos;users&apos;</span>).before({ create: validate(myValidator) });
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>validator</code> (<em>required</em>) - Validation function with signature <code>function validator(formValues, hook)</code>.</li>
</ul>
<p>Sync functions return either an error object like <code>{ fieldName1: &apos;message&apos;, ... }</code> or null.
Validate will throw on an error object with <code>throw new errors.BadRequest({ errors: errorObject });</code>.</p>
<p>Promise functions should throw on an error or reject with
<code>new errors.BadRequest(&apos;Error message&apos;, { errors: { fieldName1: &apos;message&apos;, ... } });</code>
Their <code>.then</code> returns either sanitized values to replace <code>hook.data</code>, or null.</p>
<h4 id="example">Example</h4>
<p>Comprehensive validation may include the following:</p>
<ul>
<li>Object schema validation. Checking the item object contains the expected properties with values in the expected format. The values might get sanitized. Knowing the item is well formed makes further validation simpler.</li>
<li>Re-running any validation supposedly already done on the front-end. It would an asset if the server can re-run the same code the front-end used.</li>
<li>Performing any validation and sanitization unique to the server.</li>
</ul>
<p>A full featured example of such a process appears below. It validates and sanitizes a new user before adding the user to the database.</p>
<ul>
<li>The form expects to be notified of errors in the format <code>{ email: &apos;Invalid email.&apos;, password: &apos;Password must be at least 8 characters.&apos; }</code>.</li>
<li>The form calls the server for async checking of selected fields when control leaves those fields. This for example could check that an email address is not already used by another user.</li>
<li>The form does local sync validation when the form is submitted.</li>
<li>The code performing the validations on the front-end is also used by the server.</li>
<li>The server performs schema validation using Walmart&apos;s <a href="https://github.com/hapijs/joi" target="_blank">Joi</a>.</li>
<li>The server does further validation and sanitization.</li>
</ul>
<h4 id="validation-using-validate">Validation using Validate</h4>
<pre><code class="lang-javascript"><span class="hljs-comment">// file /server/services/users/hooks/index.js</span>
<span class="hljs-keyword">const</span> auth = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-authentication&apos;</span>).hooks;
<span class="hljs-keyword">const</span> { callbackToPromise, remove, validate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
<span class="hljs-keyword">const</span> validateSchema = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-validate-joi&apos;</span>);

<span class="hljs-keyword">const</span> clientValidations = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;/common/usersClientValidations&apos;</span>);
<span class="hljs-keyword">const</span> serverValidations = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;/server/validations/usersServerValidations&apos;</span>);
<span class="hljs-keyword">const</span> schemas = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;/server/validations/schemas&apos;</span>);

<span class="hljs-keyword">const</span> serverValidationsSignup = callbackToPromise(serverValidations.signup, <span class="hljs-number">1</span>);

exports.before = {
  create: [
    validateSchema.form(schemas.signup, schemas.options), <span class="hljs-comment">// schema validation</span>
    validate(clientValidations.signup), <span class="hljs-comment">// re-run form sync validation</span>
    validate(values =&gt; clientValidations.signupAsync(values, <span class="hljs-string">&apos;someMoreParams&apos;</span>)), <span class="hljs-comment">// re-run form async</span>
    validate(serverValidationsSignup), <span class="hljs-comment">// run server validation</span>
    remove(<span class="hljs-string">&apos;confirmPassword&apos;</span>),
    auth.hashPassword()
  ]
};
</code></pre>
<h4 id="validation-routines-for-front-and-back-end">Validation routines for front and back-end.</h4>
<p>Validations used on front-end. They are re-run by the server.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// file /common/usersClientValidations</span>
<span class="hljs-comment">// Validations for front-end. Also re-run on server.</span>
<span class="hljs-keyword">const</span> clientValidations = {};

<span class="hljs-comment">// sync validation of signup form on form submit</span>
clientValidations.signup = values =&gt; {
  <span class="hljs-keyword">const</span> errors = {};

  checkName(values.name, errors);
  checkUsername(values.username, errors);
  checkEmail(values.email, errors);
  checkPassword(values.password, errors);
  checkConfirmPassword(values.password, values.confirmPassword, errors);

  <span class="hljs-keyword">return</span> errors;
};

<span class="hljs-comment">// async validation on exit from some fields on form</span>
clientValidations.signupAsync = values =&gt;
  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve, reject) =&gt; {
    <span class="hljs-keyword">const</span> errs = {};

    <span class="hljs-comment">// set a dummy error</span>
    errs.email = <span class="hljs-string">&apos;Already taken.&apos;</span>;

    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Object</span>.keys(errs).length) {
      resolve(<span class="hljs-literal">null</span>); <span class="hljs-comment">// &apos;null&apos; as we did not sanitize &apos;values&apos;</span>
    }
    reject(<span class="hljs-keyword">new</span> errors.BadRequest(<span class="hljs-string">&apos;Values already taken.&apos;</span>, { errors: errs }));
  });

<span class="hljs-built_in">module</span>.exports = clientValidations;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkName</span>(<span class="hljs-params">name, errors, fieldName = &apos;name&apos;</span>) </span>{
  <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[\\sa-zA-Z]{8,30}$/</span>.test((name || <span class="hljs-string">&apos;&apos;</span>).trim())) {
    errors[fieldName] = <span class="hljs-string">&apos;Name must be 8 or more letters or spaces.&apos;</span>;
  }
}
</code></pre>
<p>Schema definitions used by the server.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// file /server/validations/schemas</span>
<span class="hljs-keyword">const</span> Joi = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;joi&apos;</span>);

<span class="hljs-keyword">const</span> username = Joi.string().trim().alphanum().min(<span class="hljs-number">5</span>).max(<span class="hljs-number">30</span>).required();
<span class="hljs-keyword">const</span> password = Joi.string().trim().regex(<span class="hljs-regexp">/^[\sa-zA-Z0-9]+$/</span>, <span class="hljs-string">&apos;letters, numbers, spaces&apos;</span>)
  .min(<span class="hljs-number">8</span>).max(<span class="hljs-number">30</span>).required();
<span class="hljs-keyword">const</span> email = Joi.string().trim().email().required();

<span class="hljs-built_in">module</span>.exports = {
  options: { abortEarly: <span class="hljs-literal">false</span>, convert: <span class="hljs-literal">true</span>, allowUnknown: <span class="hljs-literal">false</span>, stripUnknown: <span class="hljs-literal">true</span> },
  signup: Joi.object().keys({
    name: Joi.string().trim().min(<span class="hljs-number">8</span>).max(<span class="hljs-number">30</span>).required(),
    username,
    password,
    confirmPassword: password.label(<span class="hljs-string">&apos;Confirm password&apos;</span>),
    email
  })
};
</code></pre>
<p>Validations run by the server.</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// file /server/validations/usersServerValidations</span>
<span class="hljs-comment">// Validations on server. A callback function is used to show how the hook handles it.</span>
<span class="hljs-built_in">module</span>.exports = {
  signup: (data, cb) =&gt; {
    <span class="hljs-keyword">const</span> formErrors = {};
    <span class="hljs-keyword">const</span> sanitized = {};

    <span class="hljs-built_in">Object</span>.keys(data).forEach(key =&gt; {
      sanitized[key] = (data[key] || <span class="hljs-string">&apos;&apos;</span>).trim();
    });

    cb(<span class="hljs-built_in">Object</span>.keys(formErrors).length &gt; <span class="hljs-number">0</span> ? formErrors : <span class="hljs-literal">null</span>, sanitized);
  }
};
</code></pre>
<p>See also validateSchema.</p>
<h2 id="validateschema">validateSchema</h2>
<h3 id="validateschemaschema-ajv-options-source"><code>validateSchema(schema, ajv, options)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/validate-schema.js" target="_blank">source</a></h3>
<p>Validate an object using <a href="http://json-schema.org/" target="_blank">JSON-Schema</a> through <a href="https://github.com/epoberezkin/ajv" target="_blank">AJV</a></p>
<blockquote>
<p><strong>ProTip</strong> There are some
<a href="https://code.tutsplus.com/tutorials/validating-data-with-json-schema-part-1--cms-25343" target="_blank">good tutorials</a>
on using JSON-Schema with <a href="https://github.com/epoberezkin/ajv" target="_blank">ajv</a>.</p>
</blockquote>
<ul>
<li>Used as a <code>before</code> or <code>after</code> hook.</li>
<li>The hook will throw if the data does not match the JSON-Schema.
<code>error.errors</code> will, by default, contain an array of error messages.</li>
</ul>
<blockquote>
<p><strong>ProTip</strong> You may customize the error message format with a custom formatting function.
You could, for example, return <code>{ name1: message, name2: message }</code>
which could be more suitable for a UI.</p>
<p><strong>ProTip</strong> If you need to customize <code>ajv</code> with new keywords, formats or schemas, then instead of passing the <code>Ajv</code> constructor, you may pass in an instance of <code>Ajv</code> as the second parameter. In this case you need to pass <code>ajv</code> options to the <code>ajv</code> instance when <code>new</code>ing, rather than passing them in the third parameter of <code>validateSchema</code>. See the second example below. </p>
</blockquote>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> Ajv = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;ajv&apos;</span>);
<span class="hljs-keyword">const</span> createSchema = { <span class="hljs-comment">/* JSON-Schema */</span> };
<span class="hljs-built_in">module</span>.before({
  create: validateSchema(createSchema, Ajv)
});
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> Ajv = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;ajv&apos;</span>);
<span class="hljs-keyword">const</span> ajv = <span class="hljs-keyword">new</span> Ajv({ allErrors: <span class="hljs-literal">true</span>, $data: <span class="hljs-literal">true</span> });
ajv.addFormat(<span class="hljs-string">&apos;allNumbers&apos;</span>, <span class="hljs-string">&apos;^\d+$&apos;</span>);
<span class="hljs-keyword">const</span> createSchema = { <span class="hljs-comment">/* JSON-Schema */</span> };
<span class="hljs-built_in">module</span>.before({
  create: validateSchema(createSchema, ajv)
});
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>schema</code> (<em>required</em>) - The JSON-Schema.</li>
<li><code>ajv</code> (<em>required</em>) - The <code>ajv</code> validator. Could be either the <code>Ajv</code> constructor or an instance of it.</li>
<li><code>options</code> (<em>optional</em>) - Options. <ul>
<li>Any <code>ajv</code> options. Only effective when the second parameter is the <code>Ajv</code> constructor.</li>
<li><code>addNewError</code> (<em>optional</em>) - Custom message formatter.
Its a reducing function which works similarly to <code>Array.reduce()</code>.
Its signature is
<code>{ currentFormattedMessages: any, ajvError: AjvError, itemsLen: number, index: number }: newFormattedMessages</code><ul>
<li><code>currentFormattedMessages</code> - Formatted messages so far. Initially <code>null</code>.</li>
<li><code>ajvError</code> - <a href="https://github.com/epoberezkin/ajv#error-objects" target="_blank">ajv error</a>.</li>
<li><code>itemsLen</code> - How many data items there are. 1-based.</li>
<li><code>index</code> - Which item this is. 0-based.</li>
<li><code>newFormattedMessages</code> - The function returns the updated formatted messages.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="when">when</h2>
<p>An alias for <a href="#iff">iff</a> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/iff.js" target="_blank">source</a></p>
<h2 id="util-callbacktopromise">Util: callbackToPromise</h2>
<h3 id="callbacktopromisecallbackfunc-paramscount-source"><code>callbackToPromise(callbackFunc, paramsCount)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/callback-to-promise.js" target="_blank">source</a></h3>
<p>Wrap a function calling a callback into one that returns a Promise.</p>
<ul>
<li>Promise is rejected if the function throws.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { callbackToPromise } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tester</span>(<span class="hljs-params">data, a, b, cb</span>) </span>{
  <span class="hljs-keyword">if</span> (data === <span class="hljs-number">3</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;error thrown&apos;</span>); }
  cb(data === <span class="hljs-number">1</span> ? <span class="hljs-literal">null</span> : <span class="hljs-string">&apos;bad&apos;</span>, data);
} 
<span class="hljs-keyword">const</span> wrappedTester = callbackToPromise(tester, <span class="hljs-number">3</span>); <span class="hljs-comment">// because func call requires 3 params</span>

wrappedTester(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// tester(1, 2, 3, wrapperCb)</span>
wrappedTester(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// tester(1, 2, undefined, wrapperCb)</span>
wrappedTester(); <span class="hljs-comment">// tester(undefined, undefined undefined, wrapperCb)</span>
wrappedTester(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// tester(1, 2, 3, wrapperCb)</span>

wrappedTester(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).then( ... )
  .catch(err =&gt; { <span class="hljs-built_in">console</span>.log(err <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span> ? err.message : err); });
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>callbackFunc</code> (<em>required</em>) - A function which uses a callback as its last param.</li>
<li><code>paramsCount</code> (<em>required</em>) - The number of parameters <code>callbackFunc</code> expects. This count does not include the callback param itself.</li>
</ul>
<p>The wrapped function will always be called with that many params, preventing potential bugs.</p>
<p>See also promiseToCallback.</p>
<h2 id="util-checkcontext">Util: checkContext</h2>
<h3 id="checkcontexthook-type-methods-label-source"><code>checkContext(hook, type, methods, label)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/check-context.js" target="_blank">source</a></h3>
<p>Restrict the hook to a hook type (before, after) and a set of
hook methods (find, get, create, update, patch, remove).</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> { checkContext } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myHook</span>(<span class="hljs-params">hook</span>) </span>{
  checkContext(hook, <span class="hljs-string">&apos;before&apos;</span>, [<span class="hljs-string">&apos;create&apos;</span>, <span class="hljs-string">&apos;remove&apos;</span>]);
  ...
}

app.service(<span class="hljs-string">&apos;users&apos;</span>).after({
  create: [ myHook ] <span class="hljs-comment">// throws</span>
});

<span class="hljs-comment">// checkContext(hook, &apos;before&apos;, [&apos;update&apos;, &apos;patch&apos;], &apos;hookName&apos;);</span>
<span class="hljs-comment">// checkContext(hook, null, [&apos;update&apos;, &apos;patch&apos;]);</span>
<span class="hljs-comment">// checkContext(hook, &apos;before&apos;, null, &apos;hookName&apos;);</span>
<span class="hljs-comment">// checkContext(hook, &apos;before&apos;);</span>
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>hook</code> (<em>required</em>) - The hook provided to the hook function.</li>
<li><code>type</code> (<em>optional</em>) - The hook may be run in <code>before</code> or <code>after</code>. <code>null</code> allows the hook to be run in either.</li>
<li><code>methods</code> (<em>optional</em>) - The hook may be run for these methods.</li>
<li><code>label</code> (<em>optional</em>) - The label to identify the hook in error messages, e.g. its name.</li>
</ul>
<h2 id="util-deletebydot">Util: deleteByDot</h2>
<h3 id="deletebydotobj-path-source"><code>deleteByDot(obj, path)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/delete-by-dot.js" target="_blank">source</a></h3>
<p><code>deleteByDot</code> deletes a property from an object using dot notation, e.g. <code>employee.address.city</code>.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { deleteByDot } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;

<span class="hljs-keyword">const</span> discardPasscode = () =&gt; (hook) =&gt; {
  deleteByDot(hook.data, <span class="hljs-string">&apos;security.passcode&apos;</span>);
}

app.service(<span class="hljs-string">&apos;directories&apos;</span>).before = {
  find: discardPasscode()
};
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>obj</code> (<em>required</em>) - The object containing the property we want to delete.</li>
<li><code>path</code> (<em>required</em>) - The path to the data, e.g. <code>security.passcode</code>. Array notion is <em>not</em> supported, e.g. <code>order.lineItems[1].quantity</code>.</li>
</ul>
<p>See also existsByDot, getByDot, setByDot.</p>
<h2 id="util-existsbydot">Util: existsByDot</h2>
<h3 id="existsbydotobj-path-source"><code>existsByDot(obj, path)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/exists-by-dot.js" target="_blank">source</a></h3>
<p><code>existsByDot</code> checks if a property exists in an object using dot notation, e.g. <code>employee.address.city</code>.
Properties with a value of <code>undefined</code> are considered to exist.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { discard, existsByDot, iff } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;

<span class="hljs-keyword">const</span> discardBadge = () =&gt; iff(!existsByDot(<span class="hljs-string">&apos;security.passcode&apos;</span>), discard(<span class="hljs-string">&apos;security.badge&apos;</span>));

app.service(<span class="hljs-string">&apos;directories&apos;</span>).before = {
  find: discardBadge()
};
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>obj</code> (<em>required</em>) - The object containing the property.</li>
<li><code>path</code> (<em>required</em>) - The path to the property, e.g. <code>security.passcode</code>. Array notion is <em>not</em> supported, e.g. <code>order.lineItems[1].quantity</code>.</li>
</ul>
<p>See also existsByDot, getByDot, setByDot.</p>
<h2 id="util-getbydot-setbydot">Util: getByDot, setByDot</h2>
<h3 id="getbydotobj-path-source"><code>getByDot(obj, path)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/get-by-dot.js" target="_blank">source</a></h3>
<h3 id="setbydotobj-path-value-ifdelete-source"><code>setByDot(obj, path, value, ifDelete)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/common/set-by-dot.js" target="_blank">source</a></h3>
<p><code>getByDot</code> gets a value from an object using dot notation, e.g. <code>employee.address.city</code>. It does not differentiate between non-existent paths and a value of <code>undefined</code>.</p>
<p><code>setByDot</code> is the companion to <code>getByDot</code>. It sets a value in an object using dot notation.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { getByDot, setByDot } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;

<span class="hljs-keyword">const</span> setHomeCity = () =&gt; (hook) =&gt; {
  <span class="hljs-keyword">const</span> city = getByDot(hook.data, <span class="hljs-string">&apos;person.address.city&apos;</span>);
  setByDot(hook, <span class="hljs-string">&apos;data.person.home.city&apos;</span>, city);
}

app.service(<span class="hljs-string">&apos;directories&apos;</span>).before = {
  create: setHomeCity()
};
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>obj</code> (<em>required</em>) - The object we get data from or set data in.</li>
<li><code>path</code> (<em>required</em>) - The path to the data, e.g. <code>person.address.city</code>. Array notion is <em>not</em> supported, e.g. <code>order.lineItems[1].quantity</code>.</li>
<li><code>value</code> (<em>required</em>) - The value to set the data to.</li>
</ul>
<p>See also existsByDot, deleteByDot.</p>
<h2 id="util-getitems-replaceitems">Util: getItems, replaceItems</h2>
<h3 id="getitemshook-source"><code>getItems(hook)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/get-items.js" target="_blank">source</a></h3>
<h3 id="replaceitemshook-items-source"><code>replaceItems(hook, items)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/replace-items.js" target="_blank">source</a></h3>
<p><code>getItems</code> gets the data items in a hook. The items may be <code>hook.data</code>, <code>hook.result</code> or <code>hook.result.data</code> depending on where the hook is used, the method its used with and if pagination is used. <code>undefined</code>, an object or an array of objects may be returned.</p>
<p><code>replaceItems</code> is the companion to <code>getItems</code>. It updates the data items in the hook.</p>
<ul>
<li>Handles before and after hooks.</li>
<li>Handles paginated and non-paginated results from <code>find</code>.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { getItems, replaceItems } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;

<span class="hljs-keyword">const</span> insertCode = (code) =&gt; (hook) {
    <span class="hljs-keyword">const</span> items = getItems(hook);
    !<span class="hljs-built_in">Array</span>.isArray(items) ? items.code = code : (items.forEach(item =&gt; { item.code = code; }));
    replaceItems(hook, items);
  }

app.service(<span class="hljs-string">&apos;messages&apos;</span>).before = { 
  create: insertCode(<span class="hljs-string">&apos;a&apos;</span>)
};
</code></pre>
<p>The common hooks usually mutate the items in place, so a <code>replaceItems</code> is not required.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> items = getItems(hook);
(<span class="hljs-built_in">Array</span>.isArray(items) ? items : [items]).forEach(item =&gt; { item.setCreateAt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(); });
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>hook</code> (<em>required</em>) - The hook provided to the hook function.</li>
<li><code>items</code> (<em>required</em>) - The updated item or array of items.</li>
</ul>
<h2 id="util-paramsforserver">Util: paramsForServer</h2>
<h3 id="paramsforserverparams--whitelist-source"><code>paramsForServer(params, ... whitelist)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/params-to-server.js" target="_blank">source</a></h3>
<p>A client utility to pass selected <code>params</code> properties to the server.</p>
<ul>
<li>Companion to the server-side hook <code>paramsFromClient</code>.</li>
</ul>
<p>By default, only the <code>hook.params.query</code> object is transferred
to the server from a Feathers client,
for security among other reasons.
However you can explicitly transfer other <code>params</code> props with
the client utility function <code>paramsForServer</code> in conjunction with
the hook function <code>paramsFromClient</code> on the server.</p>
<pre><code class="lang-js"><span class="hljs-comment">// client</span>
<span class="hljs-keyword">import</span> { paramsForServer } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>;
service.patch(<span class="hljs-literal">null</span>, data, paramsForServer({
  query: { dept: <span class="hljs-string">&apos;a&apos;</span> }, populate: <span class="hljs-string">&apos;po-1&apos;</span>, serialize: <span class="hljs-string">&apos;po-mgr&apos;</span>
}));

<span class="hljs-comment">// server</span>
<span class="hljs-keyword">const</span> { paramsFromClient } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;feathers-hooks-common&apos;</span>);
service.before({ all: [
  paramsFromClient(<span class="hljs-string">&apos;populate&apos;</span>, <span class="hljs-string">&apos;serialize&apos;</span>, <span class="hljs-string">&apos;otherProp&apos;</span>),
  myHook
]});

<span class="hljs-comment">// myHook&apos;s `hook.params` will now be</span>
<span class="hljs-comment">// { query: { dept: &apos;a&apos; }, populate: &apos;po-1&apos;, serialize: &apos;po-mgr&apos; } }</span>
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>params</code> (<em>optional</em>) The <code>params</code> object to pass to the server, including any <code>query</code> prop.</li>
<li><code>whitelist</code> (<em>optional</em>) Names of the props in <code>params</code> to transfer to the server.
This is a security feature. All props are transferred if no whitelist is specified.</li>
</ul>
<p>See <code>paramsFromClient</code>.</p>
<h2 id="util-promisetocallback">Util: promiseToCallback</h2>
<h3 id="promisetocallbackpromisecallbackfunc-source"><code>promiseToCallback(promise)(callbackFunc)</code> <a href="https://github.com/feathersjs/feathers-hooks-common/blob/master/src/services/promise-to-callback.js" target="_blank">source</a></h3>
<p>Wrap a Promise into a function that calls a callback.</p>
<ul>
<li>The callback does not run in the Promise&apos;s scope. The Promise&apos;s <code>catch</code> chain is not invoked if the callback throws.</li>
</ul>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { promiseToCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;feathers-hooks-common&apos;</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cb</span>) </span>{
  <span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>( ...).then( ... ).catch( ... );
  ...
  promiseToCallback(promise)(cb);
  promise.then( ... ); <span class="hljs-comment">// this is still possible</span>
}
</code></pre>
<p><strong>Options:</strong></p>
<ul>
<li><code>promise</code> (<em>required</em>) - A function returning a promise.</li>
</ul>
<p>See also callbackToPromise.</p>
<h2 id="faq-coerce-data-types">FAQ: Coerce data types</h2>
<p>A common need is converting fields coming in from query params.
These fields are provided as string values by default and you may need them as numbers, boolenas, etc.</p>
<p>The <a href="#validateSchema"><code>validateSchema</code></a> does a wide selection of
<a href="https://github.com/epoberezkin/ajv/blob/master/COERCION.md" target="_blank">type coercions</a>,
as well as checking for missing and unexpected fields.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="hooks.html" class="navigation navigation-prev " aria-label="Previous page: Hooks">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="client.html" class="navigation navigation-next " aria-label="Next page: Client">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Common Hooks","level":"1.3.1.4","depth":3,"next":{"title":"Client","level":"1.3.1.5","depth":3,"path":"api/client.md","ref":"api/client.md","articles":[]},"previous":{"title":"Hooks","level":"1.3.1.3","depth":3,"path":"api/hooks.md","ref":"api/hooks.md","articles":[]},"dir":"ltr"},"config":{"plugins":["feathers-collapsible-menu","heading-anchors","include-codeblock","edit-link","ga","feathers-versions"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"heading-anchors":{},"highlight":{},"feathers-versions":{},"ga":{"configuration":"auto","token":"UA-64904930-1"},"versions":{"gitbookConfigURL":"https://raw.githubusercontent.com/feathersjs/feathers-docs/master/book.json","options":[{"value":"https://docs.feathersjs.com","text":"Latest Stable (Auk)"},{"value":"https://legacy.docs.feathersjs.com","text":"Legacy (Pre-Auk)"}]},"include-codeblock":{"check":false,"edit":false,"fixlang":false,"lang":"","template":"default","theme":"chrome","unindent":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"edit-link":{"label":"Edit This Page","placement":"left","base":"https://github.com/feathersjs/feathers-docs/edit/master"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"feathers-collapsible-menu":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"language":"ko","gitbook":"*"},"file":{"path":"api/hooks-common.md","mtime":"2017-07-07T07:10:07.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-07-08T04:59:22.333Z"},"basePath":"..","book":{"language":"ko"}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-feathers-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.2.1/anchor.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-heading-anchors/anchor-style.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-feathers-versions/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

